<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DietPlanner Pro</title>
    
    <!-- Ë®≠ÂÆö iPhone ‰∏ªÁï´Èù¢ Icon -->
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/kerryraquel/DietPlanner-Pro/9e23209bb060a3b519946300ee5fda95a419564c/IMG_2979.png">
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/kerryraquel/DietPlanner-Pro/9e23209bb060a3b519946300ee5fda95a419564c/IMG_2979.png">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        /* Èö±Ëóè Scrollbar ‰ΩÜ‰øùÁïôÂäüËÉΩ */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        /* ÂãïÁï´ */
        @keyframes slide-in {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        .animate-slide-in { animation: slide-in 0.3s ease-out forwards; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div id="app" class="min-h-screen pb-32 w-full overflow-x-hidden">
        <!-- ÂÖßÂÆπÂ∞áÁî± JavaScript ÂãïÊÖãÊ∏≤Êüì -->
    </div>

    <script>
        // --- 1. Êï∏ÊìöÂ∫´ËàáÂàÜÈ°ûÈÇèËºØ ---
        const RAW_RECIPES = [
            "ËòãÊûúËÇâÊ°ÇÁÉ§ÁáïÈ∫•", "Ëù¶‰ªÅÁâõËÇâÊãåÈ∫µ", "Ê™∏Ê™¨‰πæÁÖéÈõû", "Ê§∞ËèúÁµ≤ÁáòËÇâÁµ≤", "ËñØÁµ≤Â®ÉÂ®ÉËèúÁâõËÇâÁâáËí∏Ëõã", "Ê≥ïÂºèÊ©ôÈ¶ôÁ¥ôÂåÖÈ≠ö", "Áø†ÁéâÁìúÁµ≤Ëù¶‰ªÅÈ§Ö",
            "CajunÈ¶ôÊñôÈõûÈ´ÄÈ£Ø", "Ëù¶‰ªÅËäãÁµ≤ÈùíÁìúÈõûËõãÊ≤ôÂæã", "Spicy Salmon poke bowl", "Miso Mushroom Coconut Milk Udon", "Caesar Salad with chicken",
            "Shepherd‚Äôs Pie", "Ê¥ãËî•Êú®ËÄ≥ÁÇíÈõûËõã", "ÊÑèÂºèËî¨ËèúÊπØ", "Toscana Salmon", "Ëä±Ê§íÈùíÊ§íÁÇíÈõû‰∏Å",
            "ËòãÊûúÁÇñË±¨Êâí", "ÈÖ∏Ëæ£ËñØÁµ≤ÁáòÁâõËÇâ", "Âú∞‰∏≠Êµ∑Ëù¶Áø†ÁéâÁìúÂΩ©Ê§í", "Ê≥ïÂºèËèåËèáÁÇñÈõû", "ËäùÂ£´ÁâõËÇâËî¨ËèúÈçã",
            "ÈªëÊùæÈú≤ËòëËèáËù¶", "ÁôΩËòëËèáÁÇíÈõûÈ´ÄËÇâ", "Â®ÉÂ®ÉËèúÁï™ËåÑÁ≤âÁµ≤ÁáúÁâõËÇâ", "Áï™ËåÑÁâõËÇâË±ÜËÖêÁÖ≤", "Á≤âÁµ≤ÁØÄÁìúËù¶Á±≥",
            "ËòÜÁ≠çÁÉ§‰∏âÊñáÈ≠öËñØ‰ªî", "Ëë°ÂºèËù¶‰ªÅÊ∞¥ÁâõËäùÂ£´ÈõûËõãÊ≤ôÂæã", "Èï∑ÈÇäË±ÜÂçóÁìúÈõûËÇâ", "ÈùíÁìúÁâõÊ≤πÊûúË±ÜËäΩÂ±±ÁæäËäùÂ£´‰∏âÊñáÊ≤ª", "ÁâõÊ≤πÊûúÈõûËÇâÂ∏åËáò‰π≥ÈÖ™wrap",
            "ÁâõÊ≤πÊûúËäíÊûúËù¶‰ªÅËÅñÂ•≥ÊûúÊ≤ôÂæã", "Ë≤ùË≤ùÂçóÁìúËù¶ÈõûËÉ∏ËòÜÁ≠çÁ¥ÖËòøËîîËñØ‰ªîÁ©∫Ê∞£ÁÇ∏Èçã", "ÁÉ§ËñØ‰ªîËù¶‰ªÅËòÜÁ≠çÁôΩËòëËèá", "ÁÉ§Ê§∞ËèúBBÁ¥ÖËñØÈõûËõãÊ≤ôÂæã", "Ë•øËò≠Ëä±ÁâõËÇâÁÇíÁÉèÂÜ¨",
            "Á≤üÁ±≥ÈõûËÉ∏Ê≤ôÂæã", "ÁÉ§Ê§∞ËèúÈÖçRomesco Sauce", "creamy garlic Ë•øËò≠Ëä±‰∏âÊñáÈ≠öpoke", "ËíúÁÉ§ÈõûËÇâÁ¥ÖËòøËîîÁø†ÁéâÁìúËñØ‰ªîË•øËò≠Ëä±", "ÁÉ§ÈõûÈ´ÄÁ≤üÁ±≥ÔºåÂ∏åËáòÊ≤ôÂæã",
            "ÁÉ§È≠öÁÉöËõãËòÜÁ≠çË•øËò≠Ëä±ËñØ‰ªî", "silken tofu pasta", "Áø†ÁéâÁìú+ÁÖô‰∏âÊñáÈ≠ö/ÁÖéËõã/Ëù¶‰ªÅ/ÈõûËÉ∏+ÁâõÊ≤πÊûú/ÁîüËèú/ÁîúÊ§í+Â∞ëÈáèËäùÂ£´Á¢éÂç∑È§Ö", "Â®ÉÂ®ÉËèúÈõûËõãË±ÜËÖêÊπØ", "Â®ÉÂ®ÉËèúÁ≤âÁµ≤ÁÇÜÁâõËÇâ",
            "Ëæ£Âë≥ÈÆÆËù¶ÈõúËî¨", "ËïÉËåÑËñØ‰ªîÁâõËÇâÊπØ", "ËòøËîîÁÖéËõãÊπØ", "ËïÉËåÑÈáëÈáùËèáË±ÜËÖêÊπØ", "Ëè†ËèúÈõûËõãÊπØ",
            "Á¥´ËèúÁâõËÇâËÇâÊπØ", "ËïÉËåÑÁÇíËõã+Ê∏ÖÁÇíËî¨Ëèú", "ËíúÈ¶ôËòëËèáÁÇÜËù¶‰ªÅ/ÁÖéÈõû", "ÈÖ∏Â•∂ËñØ‰ªîÈõûËõãÊ≤ôÂæã", "Áø†ÁéâÁìúÁÇíÁâõËÇâ+ÁÇíË±ÜËäΩ",
            "Ëî¨ËèúÁâõËÇâÈçã", "Tunacado Sandwich", "Âú∞‰∏≠Êµ∑Ê™∏Ê™¨ÁÉ§ÈõûÊ≤ôÂæã", "Creamy Chicken Corn Salad", "Âú∞‰∏≠Êµ∑È¢®Âë≥Ëù¶‰ªÅÁ¢ó",
            "Á¥ÖËòøËîîÁÇíÁâõËÇâ+ÁÇíÊ§∞Ëèú", "ÂΩ©Ê§íÁôæËòëËèáÁÇíÁîüËèúÈõûËÇâ", "ÈùíÊ§íÁÇíÁâõËÇâ+ÁÇíÊ≥ïÈÇäË±Ü", "ÁâõÊ≤πÊûúÈõûËÇâÊ≤ôÂæã", "ÁâõËÇâÁ≤íÁâõÊ≤πÊûúËïÉËåÑÊ¥ãËî•wrap",
            "Ëí∏Ê∞¥Ëõã + ÂçäÊã≥Á≤óÁ≥ß + ÂçäÊã≥ËõãÁôΩË≥™+ ÁÇíËî¨Ëèú", "Ê§∞ËèúÁ¥ÖËòøËîîÁµ≤ÁÇíÈõûËõã", "Shrimp Avocado Lettuce Boats", "Ëù¶‰ªÅËäãÁµ≤Ë•øËò≠Ëä±ÁÇíËõã", "Cucumber and Avocado Sandwich",
            "Italian Frittata", "Ê∏ÖËí∏È±∏È≠ö+ÁÇíËî¨Ëèú", "Êó•ÂºèÈØñÈ≠öÂÆöÈ£ü", "ÊªëËõãËù¶‰ªÅËìãÈ£Ø", "Ê™∏Ê™¨ÊâãÊíïÈõûÂçÉÂºµÊàñËíüËíªÈ∫µÈÖçÁÉ§Ëî¨Ëèú",
            "ÈüìÂºèÊ≥°ËèúË±ÜËÖêËî¨ËèúÈçã", "Â¢®Ë•øÂì•ÈõûËÇâÁ¢ó", "È¶ôÁÖéÈõûËÖøËî¨ËèúÊâÅË±Ü", "Ë∂äÂºèÈÆÆËù¶ÈõúÈå¶Ëî¨ËèúÊò•Âç∑", "Ëó§Ê§íÁâõËÇâÁ≤íÁÇíÊôÇËî¨",
            "Ê∏ÖÁÇñÁôΩËòøËîîÁâõËÇâÊπØ", "Ê¥ãËî•Ë±¨ËÇâËî¨ËèúÊπØÈçã", "ÈõûÈ´ÄÈÇ£‰∏çÂãíÊñØÊÑèÁ≤âÁÉ§Ëî¨Ëèú", "Ê™∏Ê™¨Ëä±Ê§íÁÑóÁâõËÇâÈÖçÊ¥ãËî•ÂΩ©Ê§íËïÉËåÑ‰ªî", "ÈùíÊ§íÈõûËõãÁÇíË±ÜËÖê",
            "Â•ßÁàæËâØÈõûËÉ∏‰∏ÅÊ¥ãËî•ÁÇíÂΩ©Ê§í", "Â•ßÁàæËâØÈõûËÉ∏Ê¢ù", "ÁîüËèúËïÉËåÑ‰ªîÊ≤ôÂæã", "Ê¥ãËî•ÂΩ©Ê§íÁÇíË±¨ËÇù", "ÁÖô‰∏âÊñáÈ≠öÊªëËõãËªäÂéòËåÑÂÖ®È∫•Â§öÂ£´",
            "ËíúÈ¶ôÁâõÊü≥Á≤íËòÜÁ≠çÈÖçËñØ‰ªî", "Ëù¶‰ªÅËÇâÁ¢éÊ§∞ËèúÁµ≤ÁÇíÁ≤âÁµ≤ÁÖ≤", "ÂæÆÊ≥¢ÁàêÁâàËíúËìâËù¶‰ªÅÁ≤âÁµ≤ÁÖ≤", "ÂæÆÊ≥¢ÁàêÊùøÈüìÂºèÊ≥°ËèúÈõûËÇâÈçãËõãÁÖ≤", "ÂæÆÊ≥¢ÁàêÁâàÊ¢ÖËä±ËÇâÈÖ∏ÊπØÂ∞èÁÅ´Èçã",
            "ÂæÆÊ≥¢ÁàêÁâàÂíñÂñ±Ê¥ãËî•Á¥ÖËòøËîîÊ§∞ËèúËä±È≠ö‰∏∏ÁÉèÂÜ¨", "ÂæÆÊ≥¢ÁàêÁâàËïÉËåÑÂåÖÊ≤ôÈ≠öÈ≠îËäãÁµ≤Ë±ÜËÖêÈçã", "ÂæÆÊ≥¢ÁàêÁâàÁÖßÁáíÈõûËÖøËÇâËî¨ËèúÁÖ≤", "Overnight rolled oats + milk + fruit + chia seeds",
            "Ê∏ÖËí∏Ë±ÜËÖêÂ®ÉÂ®ÉËèúËÇâÈ§Ö", "Ê≥ïÂºèÂ∑¥ÊñØÂÖãÁÇñÈõûÈÖçËíüËíªÁ±≥ (Poulet Basquaise)"
        ];

        // ËºîÂä©ÂáΩÊï∏ÔºöÊ†πÊìöËèúÂêçÊé®Êñ∑ÂàÜÈ°ûËàáÁáüÈ§äÁ¥†
        const analyzeRecipe = (name) => {
            const n = name.toLowerCase();
            let category = 'other';
            let macros = { p: 0, c: 0, f: 0, cal: 0 };

            // 1. ÂàÜÈ°û
            if (n.includes('oats') || n.includes('ÁáïÈ∫•') || n.includes('toast') || n.includes('sandwich') || n.includes('frittata') || n.includes('breakfast') || n.includes('Â§öÂ£´')) {
                category = 'breakfast';
            } else if (n.includes('Èõû') || n.includes('chicken') || n.includes('poulet')) {
                category = 'chicken';
            } else if (n.includes('Áâõ') || n.includes('beef') || n.includes('steak')) {
                category = 'beef';
            } else if (n.includes('Ëù¶') || n.includes('È≠ö') || n.includes('salmon') || n.includes('fish') || n.includes('shrimp') || n.includes('seafood') || n.includes('tuna') || n.includes('ÈØñÈ≠ö') || n.includes('È±∏È≠ö')) {
                category = 'seafood';
            } else if (n.includes('Ë±¨') || n.includes('pork') || n.includes('ËÇâÁµ≤') || n.includes('ËÇâÈ§Ö')) {
                category = 'pork';
            } else {
                category = 'vegetarian';
            }

            // 2. ÁáüÈ§äÁ¥†‰º∞ÁÆó
            if (category === 'breakfast') {
                macros = { p: 22, c: 45, f: 10 }; 
            } else if (category === 'chicken') {
                macros = { p: 38, c: 35, f: 10 }; 
            } else if (category === 'beef') {
                macros = { p: 35, c: 30, f: 16 }; 
            } else if (category === 'seafood') {
                macros = { p: 36, c: 35, f: 12 }; 
            } else if (category === 'pork') {
                macros = { p: 32, c: 30, f: 18 }; 
            } else { 
                macros = { p: 20, c: 45, f: 14 }; 
            }

            // ÂæÆË™ø
            if (n.includes('È£Ø') || n.includes('È∫µ') || n.includes('ÊÑèÁ≤â') || n.includes('pasta') || n.includes('udon')) {
                macros.c += 15;
            } else if (n.includes('Ê≤ôÂæã') || n.includes('salad') || n.includes('ÊπØ') || n.includes('soup')) {
                macros.c -= 10;
            }

            macros.cal = (macros.p * 4) + (macros.c * 4) + (macros.f * 9);

            return { category, macros };
        };

        const RECIPES = RAW_RECIPES.map((name, index) => {
            const analysis = analyzeRecipe(name);
            return {
                id: index,
                name,
                type: analysis.category === 'breakfast' ? 'breakfast' : 'lunch_dinner',
                category: analysis.category,
                macros: analysis.macros
            };
        });

        const generateIngredients = (name, level, type) => {
            let ings = [];
            const n = name.toLowerCase();
            
            if (n.includes('ËòãÊûúËÇâÊ°ÇÁÉ§ÁáïÈ∫•')) return [{ text: 'ËòãÊûú 1ÂÄã', highlight: false }, { text: 'ÂÖ®Á≤íÁáïÈ∫• (40g)', highlight: false }, { text: 'ÁâõÂ•∂/Ê§çÁâ©Â•∂ (150ml)', highlight: false }];
            
            const meatWeight = '120-150g'; 
            if (n.includes('Èõû')) ings.push({ text: `ÈõûËÇâ: ${meatWeight}`, highlight: false });
            else if (n.includes('Áâõ')) ings.push({ text: `ÁâõËÇâ: ${meatWeight}`, highlight: false });
            else if (n.includes('Ëù¶')) ings.push({ text: 'Ëù¶‰ªÅ (15-20Èöª)', highlight: false });
            else if (n.includes('È≠ö') || n.includes('salmon')) ings.push({ text: 'È≠öÊü≥ (140g)', highlight: false });
            else if (n.includes('Ëõã')) ings.push({ text: 'ÈõûËõã (2Èöª)', highlight: false });
            else ings.push({ text: 'ÂÑ™Ë≥™ËõãÁôΩË≥™ (140g)', highlight: false });

            ings.push({ text: 'ÊôÇ‰ª§Ëî¨Ëèú (250g+)', highlight: false });

            if (type === 'breakfast') {
                ings.push({ text: 'ÁáïÈ∫•/ÂÖ®È∫•È∫µÂåÖ/ËïÉËñØ', highlight: false });
            } else {
                if (level === 'Low') ings.push({ text: 'Êæ±Á≤âÊ∏õÂçä (ÂçäÁ¢óÈ£Ø/Êã≥È†≠Â§ßËïÉËñØ)', highlight: true });
                else ings.push({ text: '1Á¢óÈ£Ø / 1ÂÄãÂ§ßËñØ‰ªî / 1‰ªΩÈ∫µ', highlight: false });
            }
            return ings;
        };

        // --- 2. Êô∫ËÉΩË≤ºÂ£´Á≥ªÁµ± (Êõ¥Êñ∞ÁâàÔºöÊ†πÊìöËèúÂêçÈóúÈçµÂ≠ó) ---
        const INGREDIENT_TIPS = {
            // ËõãÁôΩË≥™È°û
            '‰∏âÊñáÈ≠ö': '‰∏âÊñáÈ≠öÂØåÂê´Omega-3ÔºåÁÖéÁÖÆÊôÇÁÑ°ÈúÄÈ°çÂ§ñÂ§öÂä†Ê≤πÔºåÂà©Áî®È≠öÊ≤πÊú¨Ë∫´ÁöÑÊ≤πËÑÇÂç≥ÂèØ„ÄÇ',
            'salmon': '‰∏âÊñáÈ≠öÂØåÂê´Omega-3ÔºåÁÖéÁÖÆÊôÇÁÑ°ÈúÄÈ°çÂ§ñÂ§öÂä†Ê≤πÔºåÂà©Áî®È≠öÊ≤πÊú¨Ë∫´ÁöÑÊ≤πËÑÇÂç≥ÂèØ„ÄÇ',
            'ÈØñÈ≠ö': 'ÈØñÈ≠öÊ≤πËÑÇË±êÂØå‰∏îÂê´Á∂≠ÁîüÁ¥†DÔºåÂª∫Ë≠∞‰πæÁÖéÊàñÁÉ§ÔºåÊê≠ÈÖçËòøËîîÊ≥•ÂèØËß£ËÜ©Âä©Ê∂àÂåñ„ÄÇ',
            'Ëù¶': 'Ëù¶‰ªÅÊòìÁÜüÔºåËÆäËâ≤Âç≥ÂèØËµ∑ÈçãÔºåÁÖÆÂ§™‰πÖÊúÉÂ∞éËá¥ËÇâË≥™ËÆäÁ°¨ÊµÅÂ§±ÈÆÆÂë≥„ÄÇ',
            'shrimp': 'Ëù¶‰ªÅÊòìÁÜüÔºåËÆäËâ≤Âç≥ÂèØËµ∑ÈçãÔºåÁÖÆÂ§™‰πÖÊúÉÂ∞éËá¥ËÇâË≥™ËÆäÁ°¨ÊµÅÂ§±ÈÆÆÂë≥„ÄÇ',
            'ÈõûËÉ∏': 'ÈõûËÉ∏ËÇâÂÆπÊòìËÆäÊü¥ÔºåÂª∫Ë≠∞ÂàáÁâáÂæåÁî®Â∞ëË®±ÁîüÁ≤âÊàñËõãÁôΩÈÜÉË£ΩÔºåÂè£ÊÑüÊúÉÊõ¥Â´©Êªë„ÄÇ',
            'ÈõûÈ´Ä': 'ÈõûÈ´ÄËÇâÂéªÁöÆÂæåËÑÇËÇ™Âê´ÈáèÂ§ßÂπÖÈôç‰ΩéÔºåÊòØÂè£ÊÑüËàáÂÅ•Â∫∑ÁöÑÂπ≥Ë°°ÈÅ∏Êìá„ÄÇ',
            'chicken': 'ÈõûËÇâÂØåÂê´ËõãÁôΩË≥™ÔºåÂª∫Ë≠∞ÂéªÁöÆÈ£üÁî®‰ª•Ê∏õÂ∞ëÈ£ΩÂíåËÑÇËÇ™ÊîùÂÖ•„ÄÇ',
            'Áâõ': 'ÁâõËÇâÂê´ÊúâËÇåÈÖ∏ÔºåÈÅ©ÂêàÈÅãÂãïÊó•È£üÁî®„ÄÇÂàáÁâõËÇâÊôÇÈÄÜËëóÁ¥ãË∑ØÂàáÔºåÂè£ÊÑüÊúÉÊõ¥ËªüÂ´©„ÄÇ',
            'beef': 'ÁâõËÇâÂê´ÊúâËÇåÈÖ∏ÔºåÈÅ©ÂêàÈÅãÂãïÊó•È£üÁî®„ÄÇÂàáÁâõËÇâÊôÇÈÄÜËëóÁ¥ãË∑ØÂàáÔºåÂè£ÊÑüÊúÉÊõ¥ËªüÂ´©„ÄÇ',
            'Ë±ÜËÖê': 'Ë±ÜËÖêÊòØÊ§çÁâ©ÊÄßËõãÁôΩ‰πãÁéãÔºåËàáËõãÈ°ûÊê≠ÈÖçÈ£üÁî®ÔºåÊ∞®Âü∫ÈÖ∏‰∫íË£úÂê∏Êî∂ÁéáÊõ¥È´ò„ÄÇ',
            'tofu': 'Ë±ÜËÖêÊòØÊ§çÁâ©ÊÄßËõãÁôΩ‰πãÁéãÔºåËàáËõãÈ°ûÊê≠ÈÖçÈ£üÁî®ÔºåÊ∞®Âü∫ÈÖ∏‰∫íË£úÂê∏Êî∂ÁéáÊõ¥È´ò„ÄÇ',
            'Ëõã': 'ËõãÈªÉÂê´ÊúâË±êÂØåÂçµÁ£∑ËÑÇÔºå‰∏çÈúÄË¶ÅÂàªÊÑèÂè™ÂêÉËõãÁôΩÔºåÂÖ®ËõãÁáüÈ§äÂÉπÂÄºÊõ¥ÂÆåÊï¥„ÄÇ',
            
            // Êæ±Á≤â/‰∏ªÈ£üÈ°û
            'ÁáïÈ∫•': 'ÁáïÈ∫•Âê´ÊúâŒ≤-Ëë°ËÅöÈÜ£ÔºåËÉΩÊèê‰æõÊåÅ‰πÖÈ£ΩËÖπÊÑüÔºåÊê≠ÈÖçËÇâÊ°ÇÁ≤âÊõ¥ÊúâÂä©Á©©ÂÆöË°ÄÁ≥ñ„ÄÇ',
            'oats': 'ÁáïÈ∫•Âê´ÊúâŒ≤-Ëë°ËÅöÈÜ£ÔºåËÉΩÊèê‰æõÊåÅ‰πÖÈ£ΩËÖπÊÑüÔºåÊê≠ÈÖçËÇâÊ°ÇÁ≤âÊõ¥ÊúâÂä©Á©©ÂÆöË°ÄÁ≥ñ„ÄÇ',
            'ËñØ‰ªî': 'ËñØ‰ªîÂÜ∑ÂçªÂæåÊúÉÁî¢ÁîüÊäóÊÄßÊæ±Á≤âÔºåÊúâÂä©ÊñºÊéßÂà∂Ë°ÄÁ≥ñÔºåÂÅöÊàêÊ≤ôÂæãÊòØ‰∏çÈåØÁöÑÈÅ∏Êìá„ÄÇ',
            'ÂçóÁìú': 'ÂçóÁìúÂ±¨ÊñºÈ´òÊæ±Á≤âËî¨ËèúÔºåÈ£üÁî®ÊôÇË´ãÊ∏õÂ∞ëÁï∂È§êÁöÑÁ±≥È£Ø‰ªΩÈáè„ÄÇ',
            'ÊÑèÁ≤â': 'ÁÖÆÊÑèÁ≤âÊôÇÊ∞¥Ë£°Âä†ÈπΩÔºåÁÖÆËá≥Al DenteÔºàÂí¨ÈñãÊúâÁôΩÈªûÔºâÁöÑÂçáÁ≥ñÊåáÊï∏(GI)ÊØîÂÖ®ÁÜüÊõ¥‰Ωé„ÄÇ',
            'pasta': 'ÁÖÆÊÑèÁ≤âÊôÇÊ∞¥Ë£°Âä†ÈπΩÔºåÁÖÆËá≥Al DenteÔºàÂí¨ÈñãÊúâÁôΩÈªûÔºâÁöÑÂçáÁ≥ñÊåáÊï∏(GI)ÊØîÂÖ®ÁÜüÊõ¥‰Ωé„ÄÇ',
            'ÁÉèÂÜ¨': 'ÁÉèÂÜ¨ÊòìÊ∂àÂåñ‰ΩÜGIÂÄºËºÉÈ´òÔºåÂª∫Ë≠∞Êê≠ÈÖçÂ§ßÈáèËî¨ËèúÂíåËõãÁôΩË≥™‰∏ÄËµ∑È£üÁî®‰ª•Âπ≥Á©©Ë°ÄÁ≥ñ„ÄÇ',
            'Á≤âÁµ≤': 'Á≤âÁµ≤ÂÆπÊòìÂê∏Ê≤πÔºåÂª∫Ë≠∞Áî®ÁÖÆÊàñÊ∂ºÊãåÁöÑÊñπÂºèÔºåÈÅøÂÖçÁÇíÁ≤âÁµ≤ÊîùÂÖ•ÈÅéÂ§öÊ≤πËÑÇ„ÄÇ',
            'ËäãÁµ≤': 'ËäãÁµ≤/ËíüËíªÁÜ±ÈáèÊ•µ‰Ωé‰∏îÈ´òÁ∫ñÔºåÊòØÊ∏õËÑÇÊúüÂ¢ûÂä†È£ΩËÖπÊÑüÁöÑÁ•ûÂô®„ÄÇ',
            'Â§öÂ£´': 'ÈÅ∏ÊìáÂÖ®È∫•ÊàñÈõúÁ≥ßÂ§öÂ£´ÔºåÊØîÁôΩÈ∫µÂåÖËÉΩÊèê‰æõÊõ¥Â§öÁöÑÁ∂≠ÁîüÁ¥†BÁæ§ÂíåÁ∫ñÁ∂≠„ÄÇ',
            'wrap': 'Êç≤È§ÖÁöÆ‰πüÊúâÁÜ±ÈáèÔºåÂª∫Ë≠∞ÈÅ∏ÊìáÂÖ®È∫•È§ÖÁöÆÔºå‰∏¶Â§öÂåÖÂÖ•ÁîüËèúÂ¢ûÂä†È´îÁ©ç„ÄÇ',

            // Ëî¨Ëèú/Á∫ñÁ∂≠È°û
            'ÁâõÊ≤πÊûú': 'ÁâõÊ≤πÊûúÈõñÁÑ∂ÊòØÂÅ•Â∫∑Ê≤πËÑÇÔºå‰ΩÜÁÜ±ÈáèËºÉÈ´òÔºåÂª∫Ë≠∞ÊØèÊ¨°ÊéßÂà∂Âú®ÂçäÂÄã‰ª•ÂÖß„ÄÇ',
            'avocado': 'ÁâõÊ≤πÊûúÈõñÁÑ∂ÊòØÂÅ•Â∫∑Ê≤πËÑÇÔºå‰ΩÜÁÜ±ÈáèËºÉÈ´òÔºåÂª∫Ë≠∞ÊØèÊ¨°ÊéßÂà∂Âú®ÂçäÂÄã‰ª•ÂÖß„ÄÇ',
            'Ë•øËò≠Ëä±': 'Ë•øËò≠Ëä±ÂØåÂê´Á∂≠ÁîüÁ¥†CÔºåÂª∫Ë≠∞Âø´ÁÇíÊàñËí∏ÁÖÆÔºåÈÅøÂÖçÈï∑ÊôÇÈñìÊ∞¥ÁÖÆÂ∞éËá¥ÁáüÈ§äÊµÅÂ§±„ÄÇ',
            'Ëè†Ëèú': 'Ëè†ËèúÂê´ÊúâËçâÈÖ∏ÔºåÂª∫Ë≠∞ÂÖàÁÑØÊ∞¥ÂÜçÊñôÁêÜÔºåÂèØÊ∏õÂ∞ëÊæÄÂë≥‰∏¶Âπ´Âä©Èà£Ë≥™Âê∏Êî∂„ÄÇ',
            'ËòëËèá': 'ËèåËèáÈ°ûÂê´ÊúâÂ§öÈÜ£È´îÔºåËÉΩÂ¢ûÂº∑ÂÖçÁñ´ÂäõÔºå‰πæÁÖéËá≥Âá∫Ê∞¥ÂæåÈ¢®Âë≥Êõ¥ÊøÉÈÉÅ„ÄÇ',
            'Áï™ËåÑ': 'Áï™ËåÑÂä†ÁÜ±ÂæåËåÑÁ¥ÖÁ¥†Êõ¥ÂÆπÊòìË¢´Âê∏Êî∂ÔºåÂä†‰∏ÄÈªûÈªûÊ≤πÁÇíÊïàÊûúÊõ¥Â•Ω„ÄÇ',
            'ËïÉËåÑ': 'Áï™ËåÑÂä†ÁÜ±ÂæåËåÑÁ¥ÖÁ¥†Êõ¥ÂÆπÊòìË¢´Âê∏Êî∂ÔºåÂä†‰∏ÄÈªûÈªûÊ≤πÁÇíÊïàÊûúÊõ¥Â•Ω„ÄÇ',
            'Ê≤ôÂæã': 'Ê≤ôÂæãÈÜ¨ÊòØÁÜ±ÈáèÈô∑Èò±ÔºåÂª∫Ë≠∞‰ΩøÁî®Ê≤πÈÜãÊ±Å„ÄÅÊ™∏Ê™¨Ê±ÅÊàñÂ∏åËáò‰π≥ÈÖ™‰ª£ÊõøËõãÈªÉÈÜ¨„ÄÇ',
            'salad': 'Ê≤ôÂæãÈÜ¨ÊòØÁÜ±ÈáèÈô∑Èò±ÔºåÂª∫Ë≠∞‰ΩøÁî®Ê≤πÈÜãÊ±Å„ÄÅÊ™∏Ê™¨Ê±ÅÊàñÂ∏åËáò‰π≥ÈÖ™‰ª£ÊõøËõãÈªÉÈÜ¨„ÄÇ',
            'Ê§∞Ëèú': 'Ê§∞ËèúÂê´ÊúâÁ∂≠ÁîüÁ¥†UÔºåÂ∞çËÉÉÈªèËÜúÊúâ‰øùË≠∑‰ΩúÁî®ÔºåÂàáÁµ≤ÁîüÂêÉÊàñÂø´ÁÇíÁöÜÂÆú„ÄÇ',
            
            // Ë™øÂë≥/ÂÖ∂‰ªñ
            'ÂíñÂñ±': 'ÂíñÂñ±‰∏≠ÁöÑËñëÈªÉÁ¥†ÊúâÊäóÁÇé‰ΩúÁî®ÔºåÂä†ÂÖ•ÈªëËÉ°Ê§íËÉΩÂ§ßÂπÖÊèêÂçáËñëÈªÉÁ¥†ÁöÑÂê∏Êî∂Áéá„ÄÇ',
            'Ê≥°Ëèú': 'ÁôºÈÖµÈ£üÂìÅÂ¶ÇÊ≥°ËèúÂê´ÊúâÁõäÁîüËèåÔºå‰ΩÜÈàâÂê´ÈáèËºÉÈ´òÔºåÂª∫Ë≠∞Êê≠ÈÖçÊ∏ÖÊ∑°ÁöÑÈ£üÊùê„ÄÇ',
            'ÊπØ': 'È§êÂâçÂñùÊπØËÉΩÂ¢ûÂä†È£ΩËÖπÊÑüÔºå‰ΩÜË¶ÅÈÅøÂÖçÂãæËä°ÁöÑÊøÉÊπØÔºåÈÅ∏ÊìáÊ∏ÖÊπØÁÇ∫‰Ω≥„ÄÇ',
            'ËÇâÈ§Ö': 'ÂÅöËÇâÈ§ÖÊôÇÂä†ÂÖ•Ë±ÜËÖêÊàñÁáïÈ∫•ÁâáÔºåÂèØ‰ª•Ê∏õÂ∞ëËÇâÈ°ûËÑÇËÇ™ÊîùÂÖ•‰∏¶Â¢ûÂä†Âè£ÊÑüËªüÂ´©Â∫¶„ÄÇ'
        };

        const CATEGORY_FALLBACK_TIPS = {
            breakfast: "Êó©È§êÊîùÂèñË∂≥Â§†ËõãÁôΩË≥™ÔºàÂ¶ÇÈõûËõã„ÄÅÂ∏åËáò‰π≥ÈÖ™ÔºâËÉΩÊúâÊïàÊ∏õÂ∞ë‰∏ãÂçàÁöÑÈõ∂È£üÊÖæÊúõ„ÄÇ",
            seafood: "È≠öÈ°ûÂê´ÊúâË±êÂØåÁöÑ Omega-3 ËÑÇËÇ™ÈÖ∏ÔºåÊúâÂä©ÊäóÁÇéÂèäÂøÉËÖ¶Ë°ÄÁÆ°ÂÅ•Â∫∑„ÄÇ",
            chicken: "ÈõûËÇâÊòØÊ•µ‰Ω≥ÁöÑ‰ΩéËÑÇËõãÁôΩ‰æÜÊ∫êÔºåÊê≠ÈÖçÂΩ©ËôπÈ°èËâ≤ÁöÑËî¨ËèúÁáüÈ§äÊõ¥ÂùáË°°„ÄÇ",
            beef: "Á¥ÖËÇâÊîùÂèñÈáèÈÅ©‰∏≠Âç≥ÂèØÔºåÊê≠ÈÖçÂ§ßÈáèÊ∑±Ëâ≤Ëî¨ËèúÂèØ‰ª•Âπ≥Ë°°ÈÖ∏ÈπºÂÄº„ÄÇ",
            pork: "Ë±¨ËÇâÈÅ∏ÊìáÁò¶ËÇâÈÉ®‰ΩçÔºàÂ¶ÇÊ¢ÖÈ†≠Áò¶ËÇâÔºâÔºåËõãÁôΩË≥™Âê´ÈáèÂÖ∂ÂØ¶‰∏çËº∏ÁâõËÇâ„ÄÇ",
            vegetarian: "Á¥†È£üÈ§êÈªûÂª∫Ë≠∞Êê≠ÈÖçÁ∂≠ÁîüÁ¥†CË±êÂØåÁöÑËî¨ÊûúÔºåÊúâÂä©ÊñºÊ§çÁâ©ÊÄßÈêµË≥™ÁöÑÂê∏Êî∂„ÄÇ"
        };

        function getSmartTip(mealType, dayLevel, category, recipeName) {
            const lowerName = recipeName.toLowerCase();
            
            // 1. ÂÑ™ÂÖàÂåπÈÖçÔºöÊ†πÊìöËèúÂêç‰∏≠ÁöÑÈóúÈçµÂ≠ó
            for (const [key, tip] of Object.entries(INGREDIENT_TIPS)) {
                if (lowerName.includes(key)) {
                    return tip;
                }
            }

            // 2. Ê¨°Ë¶ÅÂåπÈÖçÔºöÊ†πÊìö Level (Â¶ÇÊûúÊòØ‰ΩéÁ¢≥Êó•)
            if (dayLevel === 'Low' && mealType !== 'breakfast') {
                return "‰ΩéÁ¢≥Êó•Ë®òÂæóÂ§öÂêÉÁ∂†ËëâËî¨ËèúÔºåÂ¢ûÂä†ËÜ≥È£üÁ∫ñÁ∂≠‰ª•Á∂≠ÊåÅÈ£ΩËÖπÊÑü„ÄÇ";
            }

            // 3. ÂÖúÂ∫ïÂåπÈÖçÔºöÊ†πÊìöÈ°ûÂà•
            if (CATEGORY_FALLBACK_TIPS[category]) {
                return CATEGORY_FALLBACK_TIPS[category];
            }

            // 4. ÊúÄÂæåÈÄöÁî®
            return "ÈÄ≤È£üÈ†ÜÂ∫èÂª∫Ë≠∞ÔºöÂÖàÈ£≤ÊπØ/Ê∞¥ÔºåÂÜçÈ£üËèúÔºåÊé•ËëóËÇâÔºåÊúÄÂæåÊâçÈ£üÈ£Ø„ÄÇ";
        }

        // --- 3. ÁãÄÊÖãÁÆ°ÁêÜ ---
        const USER_TARGETS = { p: 94, c: 125, f: 42 };
        const TARGET_CALORIES = (USER_TARGETS.p * 4) + (USER_TARGETS.c * 4) + (USER_TARGETS.f * 9);

        const state = {
            currentDayIndex: new Date().getDay(),
            menuOpen: false,
            weeklyData: []
        };

        function initData() {
            const breakfastOpts = RECIPES.filter(r => r.type === 'breakfast');
            const mainOpts = RECIPES.filter(r => r.type === 'lunch_dinner');
            const pick = (arr) => arr.length > 0 ? arr[Math.floor(Math.random() * arr.length)] : RECIPES[0];
            const patternMap = { 1: 'Low', 2: 'Low', 3: 'Medium', 4: 'Medium', 5: 'Low', 6: 'High', 0: 'Medium' };

            for(let i=0; i<7; i++) {
                state.weeklyData.push({
                    dayIndex: i,
                    level: patternMap[i],
                    plan: { 
                        breakfast: pick(breakfastOpts), 
                        lunch: pick(mainOpts), 
                        dinner: pick(mainOpts) 
                    },
                    skipped: { breakfast: false, lunch: false, dinner: false },
                    swapped: { breakfast: false, lunch: false, dinner: false },
                    water: i === new Date().getDay() ? 3 : 0,
                    brazilNut: true
                });
            }
        }

        // --- 4. Êìç‰ΩúÂáΩÊï∏ ---
        window.setDay = (index) => { state.currentDayIndex = index; render(); };
        window.toggleMenu = () => { state.menuOpen = !state.menuOpen; render(); };
        window.toggleMode = () => {
            const levels = ['Low', 'Medium', 'High'];
            const day = state.weeklyData[state.currentDayIndex];
            const currentIdx = levels.indexOf(day.level);
            day.level = levels[(currentIdx + 1) % 3];
            render();
        };
        window.toggleBrazilNut = () => {
            const day = state.weeklyData[state.currentDayIndex];
            day.brazilNut = !day.brazilNut;
            render();
        };
        window.updateWater = (delta) => {
            const day = state.weeklyData[state.currentDayIndex];
            let newAmount = day.water + delta;
            if (newAmount < 0) newAmount = 0;
            if (newAmount > 8) newAmount = 8;
            day.water = newAmount;
            render();
        };
        window.toggleSkip = (mealType) => {
            const day = state.weeklyData[state.currentDayIndex];
            day.skipped[mealType] = !day.skipped[mealType];
            render();
        };
        window.swapMeal = (mealType) => {
            const day = state.weeklyData[state.currentDayIndex];
            const currentMeal = day.plan[mealType];
            
            const pool = mealType === 'breakfast' 
                ? RECIPES.filter(r => r.type === 'breakfast') 
                : RECIPES.filter(r => r.type === 'lunch_dinner');
            
            let newMeal = pool[Math.floor(Math.random() * pool.length)];
            let attempts = 0;
            while (newMeal.id === currentMeal.id && attempts < 10) {
                newMeal = pool[Math.floor(Math.random() * pool.length)];
                attempts++;
            }

            day.plan[mealType] = newMeal;
            day.swapped[mealType] = true;
            day.skipped[mealType] = false;
            render();
        };

        // --- 5. Ê∏≤ÊüìÂáΩÊï∏ ---
        function render() {
            const app = document.getElementById('app');
            const dayData = state.weeklyData[state.currentDayIndex];
            
            // Ë®àÁÆóÁáüÈ§ä
            let currentCal = 0, currentP = 0, currentC = 0, currentF = 0;
            if (dayData.brazilNut) { currentCal += 33; currentP += 1; currentC += 0.5; currentF += 3.5; }

            ['breakfast', 'lunch', 'dinner'].forEach(type => {
                if (!dayData.skipped[type]) {
                    const meal = dayData.plan[type];
                    let mealC = meal.macros.c;
                    if (dayData.level === 'Low' && type !== 'breakfast') mealC = mealC * 0.7;
                    currentP += meal.macros.p;
                    currentC += mealC;
                    currentF += meal.macros.f;
                    currentCal += (meal.macros.p * 4) + (mealC * 4) + (meal.macros.f * 9);
                }
            });

            // Ê®£ÂºèËÆäÊï∏
            const getLevelStyle = (level) => {
                if (level === 'Low') return { bg: 'bg-emerald-100', text: 'text-emerald-700', bar: 'bg-emerald-500', icon: 'leaf' };
                if (level === 'Medium') return { bg: 'bg-blue-100', text: 'text-blue-700', bar: 'bg-blue-500', icon: 'battery' };
                return { bg: 'bg-orange-100', text: 'text-orange-700', bar: 'bg-orange-500', icon: 'flame' };
            };
            const levelStyle = getLevelStyle(dayData.level);
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

            // ÊßãÂª∫ HTML
            let html = '';

            // 1. Header
            html += `
                <div class="sticky top-0 z-40 bg-white border-b border-gray-200 pt-3 pb-2 px-3 shadow-sm">
                    <div class="flex justify-between items-center mb-2">
                        <h1 class="text-base font-bold text-gray-900">DietPlanner <span class="text-orange-500">Pro</span></h1>
                        <button onclick="toggleMenu()" class="p-1.5 rounded-full hover:bg-gray-100 text-gray-600"><i data-lucide="menu" class="w-5 h-5"></i></button>
                    </div>
                    <div class="grid grid-cols-7 gap-1">
                        ${state.weeklyData.map((d, i) => {
                            const isToday = i === state.currentDayIndex;
                            const dStyle = getLevelStyle(d.level);
                            return `<button onclick="setDay(${i})" class="relative h-12 rounded-lg border transition-all ${isToday ? 'border-gray-800 bg-white shadow-md ring-1 ring-gray-800' : 'border-gray-100 bg-white opacity-60'}">
                                <div class="absolute top-0 right-0 w-2.5 h-2.5 rounded-bl-lg ${dStyle.bg}"></div>
                                <div class="h-full flex flex-col justify-center items-center">
                                    <span class="text-[9px] font-bold text-gray-400 uppercase">${days[i]}</span>
                                    <span class="text-xs font-bold ${isToday ? 'text-gray-900' : 'text-gray-500'}">${d.level[0]}</span>
                                </div>
                            </button>`;
                        }).join('')}
                    </div>
                </div>
            `;

            // 2. Dashboard
            html += `
                <div class="px-3 mt-3">
                    <div class="bg-white rounded-xl p-3 shadow-sm border border-gray-100">
                        <div class="flex justify-between items-center mb-2">
                            <span class="flex items-center space-x-1 px-1.5 py-0.5 rounded text-[10px] font-bold uppercase tracking-wider ${levelStyle.bg} ${levelStyle.text}">
                                <i data-lucide="${levelStyle.icon}" class="w-3 h-3"></i><span>${dayData.level}</span>
                            </span>
                            <div class="flex items-center space-x-2">
                                <button onclick="toggleBrazilNut()" class="px-1.5 py-0.5 rounded-full border text-[10px] font-bold transition-colors ${dayData.brazilNut ? 'bg-amber-100 text-amber-800 border-amber-200' : 'bg-gray-50 text-gray-400 border-gray-100'}">üå∞ Â∑¥Ë•øÂ†ÖÊûú</button>
                                <button onclick="toggleMode()" class="w-7 h-4 rounded-full relative transition-colors ${dayData.level === 'Low' ? 'bg-emerald-500' : dayData.level === 'Medium' ? 'bg-blue-500' : 'bg-orange-500'}">
                                    <div class="absolute top-0.5 left-0.5 bg-white w-3 h-3 rounded-full shadow transition-transform ${dayData.level === 'Low' ? 'translate-x-0' : dayData.level === 'Medium' ? 'translate-x-1.5' : 'translate-x-3'}"></div>
                                </button>
                            </div>
                        </div>
                        <div class="flex items-baseline mb-3">
                            <span class="text-2xl font-bold text-gray-900 mr-1">${Math.round(currentCal)}</span>
                            <span class="text-xs text-gray-400">/ ${Math.round(TARGET_CALORIES)} kcal</span>
                        </div>
                        <div class="grid grid-cols-3 gap-2">
                            <div><div class="flex justify-between text-[10px] mb-1"><span class="font-medium text-gray-500">Prot</span><span class="text-gray-900 font-bold">${Math.round(currentP)}/${USER_TARGETS.p}</span></div><div class="w-full bg-gray-100 rounded-full h-1.5 overflow-hidden"><div class="h-full bg-slate-800 rounded-full" style="width: ${Math.min((currentP/USER_TARGETS.p)*100, 100)}%"></div></div></div>
                            <div><div class="flex justify-between text-[10px] mb-1"><span class="font-medium text-gray-500">Carb</span><span class="text-gray-900 font-bold">${Math.round(currentC)}/${USER_TARGETS.c}</span></div><div class="w-full bg-gray-100 rounded-full h-1.5 overflow-hidden"><div class="h-full rounded-full transition-colors ${levelStyle.bar}" style="width: ${Math.min((currentC/USER_TARGETS.c)*100, 100)}%"></div></div></div>
                            <div><div class="flex justify-between text-[10px] mb-1"><span class="font-medium text-gray-500">Fat</span><span class="text-gray-900 font-bold">${Math.round(currentF)}/${USER_TARGETS.f}</span></div><div class="w-full bg-gray-100 rounded-full h-1.5 overflow-hidden"><div class="h-full bg-yellow-500 rounded-full" style="width: ${Math.min((currentF/USER_TARGETS.f)*100, 100)}%"></div></div></div>
                        </div>
                    </div>
                </div>
            `;

            // 3. Water Tracker
            html += `<div class="px-3 mt-3">`;
            if (dayData.water >= 8) {
                html += `
                    <div class="bg-[#FFFEF0] border border-yellow-100 rounded-xl p-3 shadow-sm relative overflow-hidden flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            <div class="w-8 h-8 rounded-lg bg-[#FFF9C4] flex items-center justify-center"><i data-lucide="droplet" class="w-4 h-4 text-[#FBC02D] fill-[#FBC02D]"></i></div>
                            <div><h3 class="text-sm font-bold text-slate-900">Hydration Goal!</h3><p class="text-[10px] text-[#9E7F13]">8/8 Cups üéâ</p></div>
                        </div>
                        <div class="flex space-x-1">
                            <button onclick="updateWater(-1)" class="w-7 h-7 rounded-full border border-gray-200 bg-white flex items-center justify-center text-gray-400"><i data-lucide="minus" class="w-3 h-3"></i></button>
                            <button onclick="updateWater(1)" class="w-7 h-7 rounded-full bg-[#FDD835] text-white flex items-center justify-center shadow-sm"><i data-lucide="plus" class="w-3 h-3"></i></button>
                        </div>
                    </div>
                `;
            } else {
                html += `
                    <div class="bg-white rounded-xl p-2 pr-2 shadow-sm border border-gray-100 flex items-center justify-between h-12">
                        <div class="flex items-center h-full pl-1 flex-1">
                            <div class="flex items-center space-x-1 mr-2">
                                <i data-lucide="droplet" class="w-4 h-4 text-blue-500 fill-blue-500 mr-1"></i>
                                ${Array(8).fill(0).map((_, i) => `<div class="w-1.5 h-1.5 rounded-full flex-shrink-0 ${i < dayData.water ? 'bg-blue-500' : 'bg-blue-100'}"></div>`).join('')}
                            </div>
                        </div>
                        <div class="flex items-center space-x-2 pr-1">
                            <span class="text-gray-500 font-bold text-xs whitespace-nowrap">${dayData.water * 250}ml</span>
                            <div class="flex space-x-1">
                                <button onclick="updateWater(-1)" class="w-7 h-7 rounded-full border border-gray-200 flex items-center justify-center text-gray-400 hover:bg-gray-50"><i data-lucide="minus" class="w-3 h-3"></i></button>
                                <button onclick="updateWater(1)" class="w-7 h-7 rounded-full bg-blue-600 text-white flex items-center justify-center shadow-sm shadow-blue-200"><i data-lucide="plus" class="w-3 h-3"></i></button>
                            </div>
                        </div>
                    </div>
                `;
            }
            html += `</div>`;

            // 4. Meals
            html += `<div class="px-3 mt-4 space-y-3 pb-10">`;
            ['breakfast', 'lunch', 'dinner'].forEach(type => {
                const meal = dayData.plan[type];
                const skipped = dayData.skipped[type];
                const swapped = dayData.swapped[type];
                const ingredients = generateIngredients(meal.name, dayData.level, type);
                const smartTip = getSmartTip(type, dayData.level, meal.category, meal.name);
                
                let mealC = meal.macros.c;
                if (dayData.level === 'Low' && type !== 'breakfast') mealC = mealC * 0.7;
                const displayCal = Math.round((meal.macros.p * 4) + (mealC * 4) + (meal.macros.f * 9));
                
                const emojis = { breakfast: '‚òï', lunch: '‚òÄÔ∏è', dinner: 'üåô' };
                const labels = { breakfast: 'Êó©È§ê', lunch: 'ÂçàÈ§ê', dinner: 'ÊôöÈ§ê' };

                html += `
                    <div class="bg-white border rounded-xl p-4 shadow-sm transition-all ${skipped ? 'opacity-60 bg-gray-50 border-dashed border-gray-300' : 'border-gray-100'}">
                        <div class="flex justify-between items-center mb-2">
                            <div class="flex items-center space-x-2 text-gray-700">
                                <span class="text-lg">${emojis[type]}</span>
                                <span class="text-sm font-bold text-gray-900">${labels[type]}</span>
                                ${swapped ? '<span class="text-[9px] bg-blue-50 text-blue-600 px-1.5 py-0.5 rounded font-bold">Â∑≤Êõ¥Êñ∞</span>' : ''}
                            </div>
                            <span class="text-[10px] text-gray-400 font-mono border border-gray-100 px-1.5 py-0.5 rounded">${displayCal} kcal</span>
                        </div>
                        <div class="mb-3">
                            <div class="flex justify-between items-start">
                                <h3 class="text-base font-bold text-gray-800 leading-snug w-full ${skipped ? 'line-through' : ''}">${meal.name}</h3>
                                <div class="flex space-x-1 ml-2 flex-shrink-0">
                                    <button onclick="swapMeal('${type}')" class="p-1.5 rounded-full bg-gray-50 text-gray-400 hover:text-blue-600"><i data-lucide="refresh-cw" class="w-3.5 h-3.5"></i></button>
                                    <button onclick="toggleSkip('${type}')" class="p-1.5 rounded-full bg-gray-50 text-gray-400 hover:text-red-500"><i data-lucide="${skipped ? 'rotate-ccw' : 'x'}" class="w-3.5 h-3.5"></i></button>
                                </div>
                            </div>
                            ${!skipped ? `<div class="flex space-x-2 mt-1 text-[10px] text-gray-400"><span>P: ${meal.macros.p}g</span><span>C: ${Math.round(mealC)}g</span><span>F: ${meal.macros.f}g</span></div>` : ''}
                        </div>
                        ${!skipped ? `
                            <div class="space-y-1.5 mb-3">
                                ${ingredients.map(ing => `<div class="flex items-start space-x-2"><div class="mt-1 text-emerald-500 flex-shrink-0"><i data-lucide="check" class="w-3 h-3" stroke-width="3"></i></div><span class="text-xs leading-relaxed ${ing.highlight ? 'text-red-500 font-bold' : 'text-gray-600'}">${ing.text}</span></div>`).join('')}
                            </div>
                            <div class="bg-[#FFFBEB] p-2 rounded-lg flex items-start space-x-2">
                                <div class="text-yellow-500 mt-0.5 flex-shrink-0"><i data-lucide="lightbulb" class="w-3 h-3"></i></div>
                                <span class="text-[10px] text-[#92400E] leading-relaxed font-medium">${smartTip}</span>
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            html += `</div>`;

            // 5. Menu Drawer (Sorted)
            if (state.menuOpen) {
                const categoriesOrder = [
                    { key: 'breakfast', label: 'Êó©È§ê / ËºïÈ£ü' },
                    { key: 'chicken', label: 'ÈõûËÇâÊñôÁêÜ' },
                    { key: 'beef', label: 'ÁâõËÇâÊñôÁêÜ' },
                    { key: 'seafood', label: 'Êµ∑ÈÆÆ / È≠öÈ°û' },
                    { key: 'pork', label: 'Ë±¨ËÇâÊñôÁêÜ' },
                    { key: 'vegetarian', label: 'Á¥†È£ü / ÂÖ∂‰ªñ' }
                ];
                
                html += `
                    <div class="fixed inset-0 z-50 flex justify-end">
                        <div class="absolute inset-0 bg-black/30 backdrop-blur-sm" onclick="toggleMenu()"></div>
                        <div class="relative w-4/5 max-w-sm bg-white h-full shadow-2xl flex flex-col animate-slide-in">
                            <div class="p-4 border-b border-gray-100 flex justify-between items-center bg-gray-50">
                                <h2 class="text-base font-bold text-gray-900">ËèúÂñÆË≥áÊñôÂ∫´</h2>
                                <button onclick="toggleMenu()" class="p-1 rounded-full hover:bg-gray-200"><i data-lucide="x" class="w-5 h-5"></i></button>
                            </div>
                            <div class="flex-1 overflow-y-auto p-4">
                                <div class="space-y-6">
                                    ${categoriesOrder.map(cat => {
                                        const catRecipes = RECIPES.filter(r => r.category === cat.key);
                                        if (catRecipes.length === 0) return '';
                                        return `
                                            <div>
                                                <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 border-b border-gray-100 pb-1">${cat.label}</h3>
                                                <div class="space-y-2">
                                                    ${catRecipes.map(r => `
                                                        <div class="text-xs text-gray-700 p-2 bg-gray-50 rounded border border-gray-100 flex justify-between items-center">
                                                            <span class="font-medium">${r.name}</span>
                                                            <div class="flex space-x-1 text-[9px] text-gray-400"><span>P${r.macros.p}</span><span>C${r.macros.c}</span><span>F${r.macros.f}</span></div>
                                                        </div>
                                                    `).join('')}
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            app.innerHTML = html;
            lucide.createIcons();
        }

        // ÂïüÂãï
        initData();
        render();

    </script>
</body>
</html>
