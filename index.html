<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DietPlanner Pro - High Flux Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #F9FAFB;
            color: #1F2937;
            -webkit-font-smoothing: antialiased;
            min-height: 100vh;
        }
        
        /* --- Day Card Design --- */
        .day-card-new {
            background: white;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
            transition: all 0.2s ease;
            border: 1px solid #F3F4F6;
            height: 64px;
        }
        
        .day-card-active {
            border: 2px solid #1F2937;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        /* Removed "past" style as we now sort starting from Today */
        
        .corner-badge {
            position: absolute;
            top: 0;
            right: 0;
            width: 24px;
            height: 24px;
            border-bottom-left-radius: 12px;
        }

        /* --- Meal Card --- */
        .meal-card {
            background: #FFFFFF;
            border: 1px solid #F3F4F6;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
            border-radius: 1.25rem;
            transition: all 0.3s ease;
        }
        .meal-skipped {
            opacity: 0.8; 
            background-color: #FFF7ED; 
            border-style: dashed;
            border-color: #FDBA74;
        }

        /* --- Water Card Styles --- */
        .water-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .water-success-card {
            background: white;
            border-radius: 24px;
            box-shadow: 0 4px 20px rgba(250, 204, 21, 0.15);
            border: 1px solid #FEF9C3;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .water-dash {
            height: 6px;
            border-radius: 4px;
            background-color: #FDE047;
            flex: 1;
        }

        /* Nut Button */
        .nut-btn {
            transition: all 0.2s ease;
        }
        .nut-active {
            background-color: #78350F;
            color: white;
            border-color: #78350F;
        }
        .nut-inactive {
            background-color: #FFFBEB;
            color: #92400E;
            border-color: #FEF3C7;
        }

        .tip-box {
            background-color: #FFFBEB;
            border-radius: 0.5rem;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }
    </style>
</head>
<body class="pb-32">

    <!-- Header -->
    <div class="sticky top-0 z-40 bg-white/95 backdrop-blur-md border-b border-gray-100 pt-4 pb-2 px-4">
        <div class="flex justify-between items-center mb-3">
            <div>
                <h1 class="text-lg font-bold text-gray-900 tracking-tight">DietPlanner <span class="text-orange-500">Flux</span></h1>
            </div>
            
            <button onclick="window.toggleMenu()" class="group relative w-9 h-9 rounded-full transition-transform active:scale-95">
                <svg width="36" height="36" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="20" cy="20" r="20" fill="#FFF7ED"/>
                    <path d="M14 11V18C14 19.6569 15.3431 21 17 21H17.5" stroke="#EA580C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M14 11V15" stroke="#EA580C" stroke-width="2" stroke-linecap="round"/>
                    <path d="M17 11V18" stroke="#EA580C" stroke-width="2" stroke-linecap="round"/>
                    <path d="M20 11V18C20 19.6569 18.6569 21 17 21" stroke="#EA580C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M17 21V29" stroke="#EA580C" stroke-width="2" stroke-linecap="round"/>
                    <path d="M26 11V29" stroke="#EA580C" stroke-width="2" stroke-linecap="round"/>
                    <path d="M26 11C26 11 23 11 23 16V21H26" stroke="#EA580C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>

        <!-- Day Slider (Grid Layout) -->
        <div class="grid grid-cols-7 gap-1.5 mb-4" id="day-slider">
            <!-- JS Injected -->
        </div>

        <!-- Water Tracker (Dynamic) -->
        <div id="water-container">
            <!-- JS Injected -->
        </div>
    </div>

    <!-- Dashboard -->
    <div class="px-4 mt-4">
        <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-100">
            <!-- Top Row: Title, Nut, Toggle -->
            <div class="flex justify-between items-center mb-4">
                <div class="flex items-center space-x-2">
                    <h2 class="text-base font-bold text-gray-900">‰ªäÊó•ËÉΩÈáèÈÄöÈáè</h2>
                    <span id="day-type-badge" class="px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wider"></span>
                </div>
                
                <div class="flex items-center space-x-2">
                    <!-- Brazil Nut Button -->
                    <button id="nut-btn" onclick="window.toggleBrazilNut()" class="nut-btn flex items-center space-x-1 px-2 py-1 rounded-full border text-[10px] font-bold shadow-sm">
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12,2C6.48,2 2,6.48 2,12C2,17.52 6.48,22 12,22C17.52,22 22,17.52 22,12C22,6.48 17.52,2 12,2M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20Z"/></svg>
                        <span>Â∑¥Ë•øÂ†ÖÊûú</span>
                    </button>

                    <!-- Mode Toggle -->
                    <label class="relative inline-flex items-center cursor-pointer ml-1">
                        <input type="checkbox" id="mode-toggle" class="sr-only peer" onchange="window.toggleMode()">
                        <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-teal-500"></div>
                    </label>
                </div>
            </div>

            <div class="flex justify-between items-end mb-4">
                <div class="text-[10px] font-medium text-gray-400" id="mode-label">Standard</div>
                <div class="text-2xl font-bold text-gray-900 leading-none tracking-tight">
                    <span id="cal-current">0</span><span class="text-xs text-gray-400 font-normal"> / <span id="cal-target">1450</span></span>
                </div>
            </div>

            <!-- Macros -->
            <div class="space-y-3">
                <!-- Protein -->
                <div>
                    <div class="flex justify-between text-[10px] mb-1">
                        <span class="font-medium text-gray-500">ËõãÁôΩË≥™ (Protein)</span>
                        <span class="text-gray-400"><span id="prot-current" class="text-gray-900 font-bold">0</span> / <span id="prot-target">120g</span></span>
                    </div>
                    <div class="w-full bg-gray-100 rounded-full h-1.5 overflow-hidden">
                        <div id="prot-bar" class="h-full rounded-full bg-blue-500 transition-all duration-700" style="width: 0%"></div>
                    </div>
                </div>
                <!-- Carbs -->
                <div>
                    <div class="flex justify-between text-[10px] mb-1">
                        <span class="font-medium text-gray-500">ÂéüÂûãÊæ±Á≤â (Potato/Pumpkin)</span>
                        <span class="text-gray-400"><span id="carb-current" class="text-gray-900 font-bold">0</span> / <span id="carb-target">150g</span></span>
                    </div>
                    <div class="w-full bg-gray-100 rounded-full h-1.5 overflow-hidden">
                        <div id="carb-bar" class="h-full rounded-full bg-yellow-400 transition-all duration-700" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- Strategy Text -->
            <div class="mt-3 pt-3 border-t border-gray-50">
                <p class="text-[11px] text-gray-500 leading-relaxed" id="strategy-desc">
                    <!-- JS Injected -->
                </p>
            </div>
        </div>
    </div>

    <!-- Meals List -->
    <div class="px-4 mt-5 space-y-4" id="meals-container">
        <!-- JS Injected -->
    </div>

    <!-- Full Menu Drawer -->
    <div id="menu-modal" class="fixed inset-0 z-50 hidden transition-opacity duration-300" style="background-color: rgba(0,0,0,0.2); backdrop-filter: blur(2px);">
        <div class="absolute inset-y-0 right-0 w-full max-w-md bg-white shadow-2xl transform translate-x-full transition-transform duration-300 flex flex-col" id="menu-drawer">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-white z-10">
                <div>
                    <h2 class="text-lg font-bold text-gray-900">ÂÆåÊï¥ËèúÂñÆË≥áÊñôÂ∫´</h2>
                </div>
                <button onclick="window.toggleMenu()" class="w-8 h-8 rounded-full bg-gray-50 flex items-center justify-center text-gray-500 hover:bg-gray-100">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            
            <div class="flex-1 overflow-y-auto p-5 space-y-8">
                <div id="full-menu-list">
                    <!-- JS Injected -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Icons ---
        const ICONS = {
            coffee: '‚òïÔ∏è',
            sun: '‚òÄÔ∏è',
            moon: 'üåô',
            refresh: `<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/></svg>`,
            close: `<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>`,
            restore: `<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path><path d="M3 3v5h5"></path></svg>`,
            check: `<svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" class="text-green-500"><polyline points="20 6 9 17 4 12"></polyline></svg>`,
            bulb: `<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="currentColor" class="text-yellow-400"><path d="M12,2A7,7,0,0,0,5,9c0,4.2,2.33,5.56,3,8.75A1,1,0,0,0,9,19h6a1,1,0,0,0,1-1.25C16.67,14.56,19,13.2,19,9A7,7,0,0,0,12,2ZM15,17H9c-.27-1.35-1.25-2.28-1.89-3.71A9.78,9.78,0,0,1,6.1,9.39,5.92,5.92,0,0,1,12,4a5.92,5.92,0,0,1,5.9,5.39,9.78,9.78,0,0,1-1,3.9C16.25,14.72,15.27,15.65,15,17Zm-6,4a1,1,0,0,0,1,1h4a1,1,0,0,0,1-1v-1H9Z"/></svg>`,
            fire: `<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M8.5 14.5A2.5 2.5 0 0011 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a5.5 5.5 0 11-11 0c0-3.03.412-5.843 1.225-8.047C8.79 8.253 8.5 9.46 8.5 10.5c0 .93.41 1.84 1 2.5z"/></svg>`,
            leaf: `<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/></svg>`,
            run: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>`
        };

        // --- Data & Blacklist Logic ---
        const BLACKLIST = ['ËóúÈ∫•', 'Á≥ôÁ±≥', 'ËïéÈ∫•È∫µ', 'Ëã¶Áìú', 'Ê©ÑÊ¨ñ', 'ÁßãËëµ', 'Â§©Ë≤ù', 'quinoa', 'brown rice', 'soba', 'bitter melon', 'olive', 'okra', 'tempeh'];

        const RAW_RECIPES = [
            "Cobb Salad", "Ëù¶‰ªÅËäãÁµ≤ÈùíÁìúÈõûËõãÊ≤ôÂæã", "Spicy Salmon poke bowl", "Miso Mushroom Coconut Milk Udon", "Caesar Salad with chicken",
            "Shepherd‚Äôs Pie", "Ê¥ãËî•Êú®ËÄ≥ÁÇíÈõûËõã", "ÊÑèÂºèËî¨ËèúÊπØ", "Toscana Salmon", "Ëä±Ê§íÈùíÊ§íÁÇíÈõû‰∏Å",
            "ËòãÊûúÁÇñË±¨Êâí", "ÈÖ∏Ëæ£ËñØÁµ≤ÁáòÁâõËÇâ", "Âú∞‰∏≠Êµ∑Ëù¶Áø†ÁéâÁìúÂΩ©Ê§í", "Ê≥ïÂºèËèåËèáÁÇñÈõû", "ËäùÂ£´ÁâõËÇâËî¨ËèúÈçã",
            "ÈªëÊùæÈú≤ËòëËèáËù¶", "ÁôΩËòëËèáÁÇíÈõûÈ´ÄËÇâ", "Â®ÉÂ®ÉËèúÁï™ËåÑÁ≤âÁµ≤ÁáúÁâõËÇâ", "Áï™ËåÑÁâõËÇâË±ÜËÖêÁÖ≤", "Á≤âÁµ≤ÁØÄÁìúËù¶Á±≥",
            "ËòÜÁ≠çÁÉ§‰∏âÊñáÈ≠öËñØ‰ªî", "Ëë°ÂºèËù¶‰ªÅÊ∞¥ÁâõËäùÂ£´ÈõûËõãÊ≤ôÂæã", "Èï∑ÈÇäË±ÜÂçóÁìúÈõûËÇâ", "ÈùíÁìúÁâõÊ≤πÊûúË±ÜËäΩÂ±±ÁæäËäùÂ£´‰∏âÊñáÊ≤ª", "ÁâõÊ≤πÊûúÈõûËÇâÂ∏åËáò‰π≥ÈÖ™wrap",
            "ÁâõÊ≤πÊûúËäíÊûúËù¶‰ªÅËÅñÂ•≥ÊûúÊ≤ôÂæã", "Ë≤ùË≤ùÂçóÁìúËù¶ÈõûËÉ∏ËòÜÁ≠çÁ¥ÖËòøËîîËñØ‰ªîÁ©∫Ê∞£ÁÇ∏Èçã", "ÁÉ§ËñØ‰ªîËù¶‰ªÅËòÜÁ≠çÁôΩËòëËèá", "ÁÉ§Ê§∞ËèúBBÁ¥ÖËñØÈõûËõãÊ≤ôÂæã", "Ë•øËò≠Ëä±ÁâõËÇâÁÇíÁÉèÂÜ¨",
            "Á≤üÁ±≥ÈõûËÉ∏Ê≤ôÂæã", "ÁÉ§Ê§∞ËèúÈÖçRomesco Sauce", "creamy garlic Ë•øËò≠Ëä±‰∏âÊñáÈ≠öpoke", "ËíúÁÉ§ÈõûËÇâÁ¥ÖËòøËîîÁø†ÁéâÁìúËñØ‰ªîË•øËò≠Ëä±", "ÁÉ§ÈõûÈ´ÄÁ≤üÁ±≥ÔºåÂ∏åËáòÊ≤ôÂæã",
            "ÁÉ§È≠öÁÉöËõãËòÜÁ≠çË•øËò≠Ëä±ËñØ‰ªî", "silken tofu pasta", "Áø†ÁéâÁìú+ÁÖô‰∏âÊñáÈ≠ö/ÁÖéËõã/Ëù¶‰ªÅ/ÈõûËÉ∏+ÁâõÊ≤πÊûú/ÁîüËèú/ÁîúÊ§í+Â∞ëÈáèËäùÂ£´Á¢éÂç∑È§Ö", "Â®ÉÂ®ÉËèúÈõûËõãË±ÜËÖêÊπØ", "Â®ÉÂ®ÉËèúÁ≤âÁµ≤ÁÇÜÁâõËÇâ",
            "Ëæ£Âë≥ÈÆÆËù¶ÈõúËî¨", "ËïÉËåÑËñØ‰ªîÁâõËÇâÊπØ", "ËòøËîîÁÖéËõãÊπØ", "ËïÉËåÑÈáëÈáùËèáË±ÜËÖêÊπØ", "Ëè†ËèúÈõûËõãÊπØ",
            "Á¥´ËèúÁâõËÇâËÇâÊπØ", "ËïÉËåÑÁÇíËõã+Ê∏ÖÁÇíËî¨Ëèú", "ËíúÈ¶ôËòëËèáÁÇÜËù¶‰ªÅ/ÁÖéÈõû", "ÈÖ∏Â•∂ËñØ‰ªîÈõûËõãÊ≤ôÂæã", "Áø†ÁéâÁìúÁÇíÁâõËÇâ+ÁÇíË±ÜËäΩ",
            "Ëî¨ËèúÁâõËÇâÈçã", "Tunacado Sandwich", "Âú∞‰∏≠Êµ∑Ê™∏Ê™¨ÁÉ§ÈõûÊ≤ôÂæã", "Creamy Chicken Corn Salad", "Âú∞‰∏≠Êµ∑È¢®Âë≥Ëù¶‰ªÅÁ¢ó",
            "Á¥ÖËòøËîîÁÇíÁâõËÇâ+ÁÇíÊ§∞Ëèú", "ÂΩ©Ê§íÁôæËòëËèáÁÇíÁîüËèúÈõûËÇâ", "ÈùíÊ§íÁÇíÁâõËÇâ+ÁÇíÊ≥ïÈÇäË±Ü", "ÁâõÊ≤πÊûúÈõûËÇâÊ≤ôÂæã", "ÁâõËÇâÁ≤íÁâõÊ≤πÊûúËïÉËåÑÊ¥ãËî•wrap",
            "Ëí∏Ê∞¥Ëõã + ÂçäÊã≥Á≤óÁ≥ß + ÂçäÊã≥ËõãÁôΩË≥™+ ÁÇíËî¨Ëèú", "Ê§∞ËèúÁ¥ÖËòøËîîÁµ≤ÁÇíÈõûËõã", "Shrimp Avocado Lettuce Boats", "Ëù¶‰ªÅËäãÁµ≤Ë•øËò≠Ëä±ÁÇíËõã", "Cucumber and Avocado Sandwich",
            "Italian Frittata", "Ê∏ÖËí∏È±∏È≠ö+ÁÇíËî¨Ëèú", "Êó•ÂºèÈØñÈ≠öÂÆöÈ£ü", "ÊªëËõãËù¶‰ªÅËìãÈ£Ø", "Ê™∏Ê™¨ÊâãÊíïÈõûÂçÉÂºµÊàñËíüËíªÈ∫µÈÖçÁÉ§Ëî¨Ëèú",
            "ÈüìÂºèÊ≥°ËèúË±ÜËÖêËî¨ËèúÈçã", "Â¢®Ë•øÂì•ÈõûËÇâÁ¢ó", "È¶ôÁÖéÈõûËÖøËî¨ËèúÊâÅË±Ü", "Ë∂äÂºèÈÆÆËù¶ÈõúÈå¶Ëî¨ËèúÊò•Âç∑", "Ëó§Ê§íÁâõËÇâÁ≤íÁÇíÊôÇËî¨",
            "Ê∏ÖÁÇñÁôΩËòøËîîÁâõËÇâÊπØ", "Ê¥ãËî•Ë±¨ËÇâËî¨ËèúÊπØÈçã", "ÈõûÈ´ÄÈÇ£‰∏çÂãíÊñØÊÑèÁ≤âÁÉ§Ëî¨Ëèú", "Ê™∏Ê™¨Ëä±Ê§íÁÑóÁâõËÇâÈÖçÊ¥ãËî•ÂΩ©Ê§íËïÉËåÑ‰ªî", "ÈùíÊ§íÈõûËõãÁÇíË±ÜËÖê",
            "Â•ßÁàæËâØÈõûËÉ∏‰∏ÅÊ¥ãËî•ÁÇíÂΩ©Ê§í", "Â•ßÁàæËâØÈõûËÉ∏Ê¢ù", "ÁîüËèúËïÉËåÑ‰ªîÊ≤ôÂæã", "Ê¥ãËî•ÂΩ©Ê§íÁÇíË±¨ËÇù", "ÁÖô‰∏âÊñáÈ≠öÊªëËõãËªäÂéòËåÑÂÖ®È∫•Â§öÂ£´",
            "ËíúÈ¶ôÁâõÊü≥Á≤íËòÜÁ≠çÈÖçËñØ‰ªî", "Ëù¶‰ªÅËÇâÁ¢éÊ§∞ËèúÁµ≤ÁÇíÁ≤âÁµ≤ÁÖ≤", "ÂæÆÊ≥¢ÁàêÁâàËíúËìâËù¶‰ªÅÁ≤âÁµ≤ÁÖ≤", "ÂæÆÊ≥¢ÁàêÊùøÈüìÂºèÊ≥°ËèúÈõûËÇâÈçãËõãÁÖ≤", "ÂæÆÊ≥¢ÁàêÁâàÊ¢ÖËä±ËÇâÈÖ∏ÊπØÂ∞èÁÅ´Èçã",
            "ÂæÆÊ≥¢ÁàêÁâàÂíñÂñ±Ê¥ãËî•Á¥ÖËòøËîîÊ§∞ËèúËä±È≠ö‰∏∏ÁÉèÂÜ¨", "ÂæÆÊ≥¢ÁàêÁâàËïÉËåÑÂåÖÊ≤ôÈ≠öÈ≠îËäãÁµ≤Ë±ÜËÖêÈçã", "ÂæÆÊ≥¢ÁàêÁâàÁÖßÁáíÈõûËÖøËÇâËî¨ËèúÁÖ≤", "Overnight rolled oats + milk + fruit + chia seeds",
            "Ê∏ÖËí∏Ë±ÜËÖêÂ®ÉÂ®ÉËèúËÇâÈ§Ö"
        ];

        function sanitizeName(name) {
            let n = name;
            n = n.replace(/Á≥ôÁ±≥/g, 'ËñØ‰ªî');
            n = n.replace(/ËóúÈ∫•/g, 'Á≤üÁ±≥');
            n = n.replace(/ËïéÈ∫•È∫µ/g, 'ÁÉèÂÜ¨');
            n = n.replace(/Â§©Ë≤ù/g, 'Á°¨Ë±ÜËÖê');
            n = n.replace(/Ëã¶Áìú/g, 'Ë•øËò≠Ëä±');
            n = n.replace(/ÁßãËëµ/g, 'Áø†ÁéâÁìú');
            n = n.replace(/Â∏∂Â≠ê/g, 'Ëù¶‰ªÅ'); 
            return n;
        }

        function getCategory(name, type) {
            const n = name.toLowerCase();
            if (type === 'breakfast') return 'Êó©È§ê (Breakfast)';
            if (n.includes('Èõû') || n.includes('chicken')) return 'ÈõûËÇâÊñôÁêÜ (Chicken)';
            if (n.includes('Áâõ') || n.includes('beef') || n.includes('Ë±¨') || n.includes('pork') || n.includes('ËÇâ')) return 'Á¥ÖËÇâÊñôÁêÜ (Beef/Pork)';
            if (n.includes('Ëù¶') || n.includes('È≠ö') || n.includes('salmon') || n.includes('shrimp')) return 'Êµ∑ÈÆÆÊñôÁêÜ (Seafood)';
            return 'Á¥†È£ü/ËºïÈ£ü (Veggie/Light)';
        }

        function generateSubtext(name, isLight, type) {
            const n = name.toLowerCase();
            if (type === 'breakfast') return 'È´òËõãÁôΩÊó©È§êÔºåÁ©©ÂÆöÂÖ®Êó•Ë°ÄÁ≥ñ„ÄÇ';
            if (isLight) return '„Äê‰ΩéÁ¢≥Êó•„ÄëÈáçÈªûÔºöÊæ±Á≤âÈáèÊ∏õÂçäÔºå‰ΩÜË´ãÁ¢∫‰øùËµ∞ÂÆå 8000 Ê≠•„ÄÇ';
            if (n.includes('Áâõ')) return '„ÄêÈ´òÁ¢≥Êó•„ÄëÈáçÈªûÔºöË´ãÂêÉË∂≥ËñØ‰ªî/ÂçóÁìúÔºåÈÄôÊòØ‰Ω†ÈÅãÂãïÁöÑÁáÉÊñô„ÄÇ';
            return '„ÄêÈ´òÁ¢≥Êó•„ÄëÈáçÈªûÔºöÊæ±Á≤âÈÅ∏ÊìáÂ∑≤ÈéñÂÆöÁÇ∫ËñØ‰ªî/ÂçóÁìú/Á≤üÁ±≥„ÄÇ';
        }

        // --- NEW PRECISE INGREDIENT LOGIC WITH POTATO/PUMPKIN FOCUS ---
        function generateIngredients(name, isLight) {
            let ings = [];
            const n = name.toLowerCase();
            
            const meatWeight = isLight ? '140g' : '170g'; 
            const tofuWeight = isLight ? 'ÂçäÁõí (150g)' : 'Â§ßÂçäÁõí (200g)';
            const fishWeight = isLight ? '150g' : '180g';
            const shrimpCount = isLight ? '12-15Èöª' : '18-20Èöª';
            
            // 1. Protein Logic
            let protein = "";
            if (n.includes('ËòãÊûú') && n.includes('Ë±¨')) {
                protein = isLight ? 'Áò¶Ë±¨Êâí (130g, ÂéªËÑÇ)' : 'Ë±¨Êâí (160g)';
                ings.push(protein);
                ings.push('ËòãÊûú (1ÂÄã) ÂàáÂ°ä');
            } 
            else if (n.includes('Ê≥°Ëèú') && n.includes('Ë±ÜËÖê')) {
                ings.push('Â´©Ë±ÜËÖê (1Áõí/300g)');
                ings.push(isLight ? 'Áò¶ËÇâÁâá (80g)' : 'Áò¶ËÇâÁâá (120g)');
                ings.push('ÈüìÂºèÊ≥°Ëèú (100g)');
            }
            else if (n.includes('Ë±ÜËÖê') || n.includes('tofu')) {
                 if (n.includes('ËÇâ') || n.includes('Èõû') || n.includes('Áâõ')) {
                     ings.push(tofuWeight + ' Á°¨Ë±ÜËÖê'); 
                     ings.push(isLight ? 'Áò¶ËÇâ/ÈõûËÇâ (100g)' : 'ËÇâÈ°û (130g)');
                 } else {
                     ings.push('Á°¨Ë±ÜËÖê (1Áõí/300g)');
                 }
            }
            else if (n.includes('Èõû') || n.includes('chicken')) {
                ings.push(isLight ? `ÂéªÁöÆÈõûËÉ∏/ËÖøËÇâ (${meatWeight})` : `ÈõûËÖøËÇâ (${meatWeight})`);
            } else if (n.includes('Áâõ') || n.includes('beef')) {
                ings.push(isLight ? `Áò¶ÁâõÊü≥ (${meatWeight})` : `ÁâõÊü≥Á≤í (${meatWeight})`);
            } else if (n.includes('Ëù¶') || n.includes('shrimp')) {
                ings.push(`Â§ßËù¶‰ªÅ (${shrimpCount})`);
            } else if (n.includes('È≠ö') || n.includes('fish') || n.includes('salmon') || n.includes('‰∏âÊñáÈ≠ö')) {
                ings.push(isLight ? `È≠öÊü≥ (${fishWeight})` : `È≠öÊü≥/‰∏âÊñáÈ≠ö (${fishWeight})`);
            } else if (n.includes('ËÇâÈ§Ö') || n.includes('pork') || n.includes('Ë±¨')) {
                ings.push(`Áò¶ËÇâÁ¢é (${meatWeight})`);
            } else if (n.includes('Ëõã') || n.includes('egg')) {
                if (isLight) ings.push('ÈõûËõã (2Èöª)', 'ËõãÁôΩ (1Èöª)'); 
                else ings.push('ÈõûËõã (2Èöª)', 'ËõãÁôΩ (2Èöª)');
            } else {
                ings.push(`ÂÑ™Ë≥™ËõãÁôΩ (${meatWeight})`);
            }

            // 2. Vegetable Logic
            let vegAdded = false;
            if (n.includes('ËòëËèá') || n.includes('mushroom')) { ings.push('ËòëËèá/ÈáëÈáùËèá (150g)'); vegAdded = true; }
            if (n.includes('Ë•øËò≠Ëä±') || n.includes('broccoli')) { ings.push('Ë•øËò≠Ëä± (200g)'); vegAdded = true; }
            if (n.includes('Ê§∞Ëèú') || n.includes('cabbage')) { ings.push('Ê§∞ËèúÁµ≤ (200g)'); vegAdded = true; }
            if (n.includes('Â®ÉÂ®ÉËèú')) { ings.push('Â®ÉÂ®ÉËèú (200g)'); vegAdded = true; }
            if (n.includes('ËòÜÁ≠ç')) { ings.push('ËòÜÁ≠ç (150g)'); vegAdded = true; }
            if (n.includes('Áï™ËåÑ') || n.includes('tomato')) { ings.push('Áï™ËåÑ (2ÂÄã)'); vegAdded = true; }
            if (n.includes('ÈùíÁìú') || n.includes('cucumber')) { ings.push('ÈùíÁìú (1Ê¢ù)'); vegAdded = true; }
            
            if (!vegAdded) {
                if (n.includes('Ê≥°Ëèú')) {
                     ings.push('ÈáëÈáùËèá (100g)');
                     ings.push('Â®ÉÂ®ÉËèú (150g)');
                } else {
                    ings.push('ÊôÇ‰ª§Ëî¨Ëèú (250g) - ÂøÖÈ†àÂêÉË∂≥');
                }
            }

            // 3. Carb Logic - STRICT POTATO/PUMPKIN/CORN
            const starchOptions = ['Ëí∏ËñØ‰ªî', 'Ëí∏ÂçóÁìú', 'ÁîúÁ≤üÁ±≥'];
            const starchChoice = starchOptions[name.length % 3]; 

            if (isLight) {
                if (n.includes('Á≤âÁµ≤') || n.includes('vermicelli')) {
                    ings.push('ÈæçÂè£Á≤âÁµ≤ (30g ‰πæÈáç)');
                } else if (n.includes('ËäãÁµ≤') || n.includes('konjac') || n.includes('ËíüËíª')) {
                    ings.push('ËäãÁµ≤/ËíüËíªÁµê (1Áõí) + ÂçóÁìú (100g)');
                } else if (n.includes('wrap') || n.includes('‰∏âÊñáÊ≤ª') || n.includes('sandwich') || n.includes('Â§öÂ£´')) {
                    ings.push('ÁîüËèúËëâ (‰ª£ÊõøÈ∫µÂåÖ) + Á≤üÁ±≥ (ÂçäÊ¢ù)');
                } else if (n.includes('oats')) {
                    ings.push('ÁáïÈ∫•Áâá (30g)');
                } else {
                    ings.push(`${starchChoice} (100g) - ÈÅãÂãïÂâçÂêÉ`);
                }
            } else {
                const potatoPortion = '200g';
                const pumpkinPortion = '250g';
                const cornPortion = '1.5Ê¢ù';
                
                let selectedStarch = '';
                if (starchChoice === 'Ëí∏ËñØ‰ªî') selectedStarch = `Ëí∏ËñØ‰ªî (${potatoPortion})`;
                if (starchChoice === 'Ëí∏ÂçóÁìú') selectedStarch = `Ëí∏ÂçóÁìú (${pumpkinPortion})`;
                if (starchChoice === 'ÁîúÁ≤üÁ±≥') selectedStarch = `ÁîúÁ≤üÁ±≥ (${cornPortion})`;

                if (n.includes('Á≤âÁµ≤')) {
                    ings.push('ÈæçÂè£Á≤âÁµ≤ (50g ‰πæÈáç)');
                } else if (n.includes('ËäãÁµ≤') || n.includes('konjac')) {
                    ings.push(`ËäãÁµ≤ (1Áõí) + ${selectedStarch}`); 
                } else if (n.includes('wrap') || n.includes('È§Ö')) {
                    ings.push('Â¢®Ë•øÂì•È§ÖÁöÆ (1Âºµ) + Á≤üÁ±≥ (1Ê¢ù)');
                } else if (n.includes('‰∏âÊñáÊ≤ª') || n.includes('sandwich') || n.includes('Â§öÂ£´')) {
                    ings.push('ÂÖ®È∫•Â§öÂ£´ (2Áâá)');
                } else if (n.includes('oats')) {
                    ings.push('ÁáïÈ∫•Áâá (50g)');
                } else {
                    ings.push(`${selectedStarch} (‰ª£ÊõøÁôΩÈ£Ø)`);
                }
            }
            
            // 4. Fat/Cooking Oil
            ings.push(isLight ? 'ÁÖÆÈ£üÊ≤π (1Ëå∂Âåô)' : 'ÁÖÆÈ£üÊ≤π (2Ëå∂Âåô)');

            return ings;
        }

        function generateTip(name, isLight) {
            const n = name.toLowerCase();
            if (isLight) {
                return 'Ë≤ºÂ£´Ôºö‰ΩéÁ¢≥Êó•‰ªçÈúÄËÉΩÈáèÔºåË´ãÂú®È£ØÂæåÂãôÂøÖËµ∞Âãï 15 ÂàÜÈêò„ÄÇ';
            } else {
                return 'Ë≤ºÂ£´ÔºöÈ´òÁ¢≥Êó•Ë´ãÊîæÂøÉÂêÉËñØ‰ªî/ÂçóÁìúÔºåÈÄôÊòØÁÇ∫‰∫ÜÊèêÂçá‰ª£Ë¨ù„ÄÇ';
            }
        }

        const RECIPES = RAW_RECIPES.map((name, index) => {
            const n = name.toLowerCase();
            let type = 'lunch_dinner';
            if (n.includes('oats') || n.includes('toast') || n.includes('sandwich') || n.includes('frittata') || n.includes('breakfast') || index === 93 || index === 84 || index === 0) {
                type = 'breakfast';
            }
            
            let tags = ['standard'];
            if (n.includes('salad') || n.includes('soup') || n.includes('konjac') || n.includes('ËäãÁµ≤') || n.includes('Á≤âÁµ≤') || n.includes('ÂæÆÊ≥¢Áàê') || n.includes('ÊπØ') || n.includes('light') || n.includes('Ë±ÜËÖê')) {
                tags.push('light');
            }

            const cleanName = sanitizeName(name);
            return { 
                id: index, 
                name: cleanName, 
                type: type, 
                tags: tags,
                category: getCategory(cleanName, type)
            };
        });

        // --- State ---
        let appState = {
            currentDayIndex: new Date().getDay(),
            startDayIndex: new Date().getDay(), // Anchor for the slider
            weeklyData: [] 
        };

        // --- Logic ---
        function generateWeeklyPlan() {
            appState.weeklyData = [];
            const breakfastOpts = RECIPES.filter(r => r.type === 'breakfast');
            const mainOpts = RECIPES.filter(r => r.type === 'lunch_dinner');

            const pick = (arr) => arr[Math.floor(Math.random() * arr.length)];

            for(let i=0; i<7; i++) {
                let lunch = pick(mainOpts);
                let dinner = pick(mainOpts);
                
                let attempts = 0;
                while (dinner.id === lunch.id && attempts < 10) {
                    dinner = pick(mainOpts);
                    attempts++;
                }

                const isWeekend = (i === 0 || i === 6);
                const defaultLight = (i === 1 || i === 4 || i === 0);

                appState.weeklyData.push({
                    plan: {
                        breakfast: pick(breakfastOpts),
                        lunch: lunch,
                        dinner: dinner
                    },
                    skipped: { 
                        breakfast: isWeekend, 
                        lunch: false, 
                        dinner: false 
                    },
                    water: i === appState.currentDayIndex ? 3 : 0, 
                    brazilNut: true,
                    isLight: defaultLight,
                    swapped: { breakfast: false, lunch: false, dinner: false }
                });
            }
        }

        // --- Global Functions ---
        window.toggleMode = function() {
            const dayData = appState.weeklyData[appState.currentDayIndex];
            dayData.isLight = !dayData.isLight;
            renderStats();
            renderMeals();
            renderDaySlider(); 
        };

        window.toggleBrazilNut = function() {
            const dayData = appState.weeklyData[appState.currentDayIndex];
            dayData.brazilNut = !dayData.brazilNut;
            renderStats();
            renderNutButton();
            renderMeals();
        };

        window.swapMeal = function(type) {
            const dayData = appState.weeklyData[appState.currentDayIndex];
            const currentId = dayData.plan[type].id;
            
            const pool = type === 'breakfast' 
                ? RECIPES.filter(r => r.type === 'breakfast') 
                : RECIPES.filter(r => r.type === 'lunch_dinner');
            
            let newMeal = pool[Math.floor(Math.random() * pool.length)];
            let attempts = 0;
            while(newMeal.id === currentId && attempts < 10) {
                 newMeal = pool[Math.floor(Math.random() * pool.length)];
                 attempts++;
            }
            
            dayData.plan[type] = newMeal;
            dayData.skipped[type] = false;
            dayData.swapped[type] = true;
            
            renderMeals();
            renderStats();
        };

        window.toggleSkip = function(type) {
            const dayData = appState.weeklyData[appState.currentDayIndex];
            dayData.skipped[type] = !dayData.skipped[type];
            renderMeals();
            renderStats();
        };

        window.setDay = function(d) {
            appState.currentDayIndex = d;
            render();
        };

        window.addWater = function() {
            const dayData = appState.weeklyData[appState.currentDayIndex];
            dayData.water = dayData.water >= 8 ? 8 : dayData.water + 1;
            renderWater();
        };
        
        window.removeWater = function() {
            const dayData = appState.weeklyData[appState.currentDayIndex];
            dayData.water = dayData.water <= 0 ? 0 : dayData.water - 1;
            renderWater();
        };

        window.toggleMenu = function() {
            const modal = document.getElementById('menu-modal');
            const drawer = document.getElementById('menu-drawer');
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                setTimeout(() => drawer.classList.remove('translate-x-full'), 10);
            } else {
                drawer.classList.add('translate-x-full');
                setTimeout(() => modal.classList.add('hidden'), 300);
            }
        };

        // --- Render Functions ---
        function render() {
            renderDaySlider();
            renderNutButton();
            renderStats();
            renderWater();
            renderMeals();
            renderFullMenu();
        }

        function renderDaySlider() {
            const days = ['ÈÄ±Êó•', 'ÈÄ±‰∏Ä', 'ÈÄ±‰∫å', 'ÈÄ±‰∏â', 'ÈÄ±Âõõ', 'ÈÄ±‰∫î', 'ÈÄ±ÂÖ≠'];
            const enDays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const letters = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
            
            // Generate rolling indices starting from Today
            let html = '';
            for (let i = 0; i < 7; i++) {
                const dayIndex = (appState.startDayIndex + i) % 7;
                
                const active = dayIndex === appState.currentDayIndex;
                const isLight = appState.weeklyData[dayIndex].isLight;
                
                const cornerColor = isLight ? 'bg-emerald-100' : 'bg-orange-100';
                const iconColor = isLight ? 'text-emerald-500' : 'text-orange-500';
                const icon = isLight ? ICONS.leaf : ICONS.fire;
                
                let cardClass = 'day-card-new cursor-pointer ';
                if (active) cardClass += 'day-card-active ';

                // Label logic: First card is "Today"
                let label = enDays[dayIndex];
                if (i === 0) label = "Today";

                html += `
                    <button onclick="window.setDay(${dayIndex})" class="${cardClass}">
                        <div class="corner-badge ${cornerColor}"></div>
                        <div class="h-full flex flex-col justify-between p-2">
                            <div class="text-[10px] font-bold text-gray-400 uppercase leading-none text-left">${label}</div>
                            <div class="flex justify-between items-end">
                                <span class="text-xl font-bold text-gray-800 leading-none">${letters[dayIndex]}</span>
                                <span class="${iconColor} mb-0.5">${icon}</span>
                            </div>
                        </div>
                    </button>
                `;
            }
            document.getElementById('day-slider').innerHTML = html;
        }

        function renderNutButton() {
            const dayData = appState.weeklyData[appState.currentDayIndex];
            const btn = document.getElementById('nut-btn');
            if(dayData.brazilNut) {
                btn.className = "nut-btn flex items-center space-x-1 px-2 py-1 rounded-full border text-[10px] font-bold shadow-sm nut-active";
            } else {
                btn.className = "nut-btn flex items-center space-x-1 px-2 py-1 rounded-full border text-[10px] font-bold shadow-sm nut-inactive";
            }
        }

        function renderStats() {
            const dayData = appState.weeklyData[appState.currentDayIndex];
            const isLight = dayData.isLight;
            const isWeekend = (appState.currentDayIndex === 0 || appState.currentDayIndex === 6);

            const badge = document.getElementById('day-type-badge');
            badge.innerText = isLight ? 'LOW FLUX' : 'HIGH FLUX';
            badge.className = `px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wider ${isLight ? 'bg-emerald-100 text-emerald-600' : 'bg-orange-100 text-orange-600'}`;

            // Adjusted Targets for High Energy Flux
            const target = isLight ? 1250 : 1450;
            const pTarget = isLight ? 105 : 120; 
            const cTarget = isLight ? 110 : 150; 

            let total = 0, pTotal = 0, cTotal = 0;

            if (dayData.brazilNut) {
                total += 33; pTotal += 1; cTotal += 0.5;
            }

            const mealConfigs = {
                normal: { breakfast: 350, lunch: 550, dinner: 550 },
                light: { breakfast: 325, lunch: 462, dinner: 462 }, // Adjusted for 1250
                weekend_normal: { breakfast: 0, lunch: 725, dinner: 725 },
                weekend_light: { breakfast: 0, lunch: 625, dinner: 625 }
            };

            let configType = isLight ? 'light' : 'normal';
            if (isWeekend) configType = isLight ? 'weekend_light' : 'weekend_normal';
            
            const config = {...mealConfigs[configType]};

            if (dayData.brazilNut) {
                const deductionPerMeal = Math.ceil(33 / (isWeekend ? 2 : 3));
                if (!isWeekend) config.breakfast -= deductionPerMeal;
                config.lunch -= deductionPerMeal;
                config.dinner -= deductionPerMeal;
            }

            ['breakfast', 'lunch', 'dinner'].forEach(t => {
                if (!dayData.skipped[t]) {
                    const cal = Math.max(0, config[t]);
                    total += cal;
                    if (isLight) {
                         pTotal += (cal * 0.40) / 4; 
                         cTotal += (cal * 0.20) / 4; 
                    } else {
                         pTotal += (cal * 0.30) / 4; 
                         cTotal += (cal * 0.45) / 4; 
                    }
                }
            });

            const toggleLabel = document.getElementById('mode-label');
            const toggleInput = document.getElementById('mode-toggle');
            
            toggleLabel.innerText = isLight ? 'ËºïÈáèÊó• (1250)' : 'È´òËÉΩÊó• (1450)';
            toggleLabel.className = `text-[10px] font-bold uppercase tracking-wider ${isLight ? 'text-teal-600' : 'text-orange-600'}`;
            toggleInput.checked = isLight;

            // STRATEGY TEXT UPDATE FOR FLUX
            document.getElementById('strategy-desc').innerHTML = isLight 
                ? '<span class="font-bold text-teal-700">ËºïÈáèÊó• (1250)Ôºö</span>ÁõÆÊ®ô 8000 Ê≠•„ÄÇÊæ±Á≤âÂ∑≤ËΩâÁÇ∫Â∞ëÈáèÂçóÁìú/ËñØ‰ªî„ÄÇÈ£ØÂæåË´ãËµ∞Âãï 15 ÂàÜÈêò‰ª•Á©©ÂÆöË°ÄÁ≥ñ„ÄÇ' 
                : '<span class="font-bold text-orange-700">È´òËÉΩÊó• (1450)Ôºö</span>ÁõÆÊ®ô 8000 Ê≠•„ÄÇÁôΩÈ£ØÂ∑≤ÂÖ®Êï∏ÊõøÊèõÁÇ∫ËñØ‰ªî/ÂçóÁìú„ÄÇË´ãÂêÉË∂≥‰ªΩÈáè‰ª•Á∂≠ÊåÅ‰ª£Ë¨ù„ÄÇ';

            document.getElementById('cal-current').innerText = Math.round(total);
            document.getElementById('cal-target').innerText = target;
            
            document.getElementById('prot-current').innerText = Math.round(pTotal);
            document.getElementById('prot-target').innerText = pTarget + 'g';
            
            const pPct = Math.min((pTotal/pTarget)*100, 100);
            document.getElementById('prot-bar').style.width = pPct + '%';
            document.getElementById('prot-bar').className = `h-full rounded-full transition-all duration-700 ${pTotal >= pTarget ? 'bg-green-500' : 'bg-blue-500'}`;
            
            document.getElementById('carb-current').innerText = Math.round(cTotal);
            document.getElementById('carb-target').innerText = cTarget + 'g';
            const cPct = Math.min((cTotal/cTarget)*100, 100);
            document.getElementById('carb-bar').style.width = cPct + '%';
            document.getElementById('carb-bar').className = `h-full rounded-full transition-all duration-700 ${cTotal > cTarget ? 'bg-red-400' : 'bg-yellow-400'}`;
        }

        function renderWater() {
            const dayData = appState.weeklyData[appState.currentDayIndex];
            const container = document.getElementById('water-container');
            
            if (dayData.water >= 8) {
                container.innerHTML = `
                    <div class="water-success-card p-4 flex flex-col items-center justify-center space-y-3">
                        <div class="flex w-full justify-between items-center">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 rounded-2xl bg-yellow-100 flex items-center justify-center text-yellow-500">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12,22c4.97,0,9-4.03,9-9c0-4.97-9-13-9-13S3,8.03,3,13C3,17.97,7.03,22,12,22z"/></svg>
                                </div>
                                <div>
                                    <h3 class="text-sm font-bold text-gray-900">Hydration</h3>
                                    <p class="text-xs text-gray-500 font-medium">8 / 8 Cups</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button onclick="window.removeWater()" class="w-8 h-8 rounded-full border border-gray-200 flex items-center justify-center text-gray-400 hover:bg-gray-50">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                                </button>
                                <button onclick="window.addWater()" class="w-8 h-8 rounded-full bg-yellow-400 text-white flex items-center justify-center shadow-md shadow-yellow-200">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                                </button>
                            </div>
                        </div>
                        <div class="flex w-full space-x-1 px-1">
                            ${Array(8).fill(0).map(() => `<div class="water-dash"></div>`).join('')}
                        </div>
                        <div class="text-xs font-bold text-yellow-600 tracking-wide">
                            üéâ ÁõÆÊ®ôÈÅîÊàêÔºÅExcellent!
                        </div>
                    </div>
                `;
            } else {
                let dots = '';
                for(let i=0; i<8; i++) {
                    const filled = i < dayData.water;
                    dots += `<div class="water-dot ${filled ? 'bg-blue-500' : 'bg-gray-100'}"></div>`;
                }
                container.innerHTML = `
                    <div class="bg-white rounded-full p-1 pr-2 shadow-sm border border-gray-100 flex items-center justify-between">
                        <div class="w-8 h-8 rounded-full bg-blue-50 flex items-center justify-center text-blue-500 flex-shrink-0 ml-1">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" stroke="none">
                                <path d="M12,22c4.97,0,9-4.03,9-9c0-4.97-9-13-9-13S3,8.03,3,13C3,17.97,7.03,22,12,22z"/>
                            </svg>
                        </div>
                        <div class="flex space-x-1 mx-2" id="water-dots">
                            ${dots}
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="text-xs font-medium text-gray-400 tabular-nums"><span id="water-text" class="text-gray-600 font-bold">${dayData.water * 250}</span>ml</span>
                            <button onclick="window.removeWater()" class="w-8 h-8 rounded-full border border-gray-200 flex items-center justify-center text-gray-400 hover:bg-gray-50 active:scale-95 transition-transform">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                            </button>
                            <button onclick="window.addWater()" class="w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center active:scale-95 transition-transform shadow-md shadow-blue-200">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        function renderMeals() {
            const dayData = appState.weeklyData[appState.currentDayIndex];
            const isLight = dayData.isLight;
            const isWeekend = (appState.currentDayIndex === 0 || appState.currentDayIndex === 6);
            
            const types = [
                { k: 'breakfast', l: isWeekend ? 'Êó©È§ê (ÈÄ±Êú´)' : 'Êó©È§ê', icon: ICONS.coffee },
                { k: 'lunch', l: isWeekend ? 'Êó©ÂçàÈ§ê (Brunch)' : 'ÂçàÈ§ê', icon: ICONS.sun },
                { k: 'dinner', l: 'ÊôöÈ§ê', icon: ICONS.moon }
            ];

             const mealConfigs = {
                normal: { breakfast: 350, lunch: 550, dinner: 550 },
                light: { breakfast: 325, lunch: 462, dinner: 462 },
                weekend_normal: { breakfast: 0, lunch: 725, dinner: 725 },
                weekend_light: { breakfast: 0, lunch: 625, dinner: 625 }
            };
            
            let configType = isLight ? 'light' : 'normal';
            if (isWeekend) configType = isLight ? 'weekend_light' : 'weekend_normal';
            const config = {...mealConfigs[configType]};

            if (dayData.brazilNut) {
                const deductionPerMeal = Math.ceil(33 / (isWeekend ? 2 : 3));
                if (!isWeekend) config.breakfast -= deductionPerMeal;
                config.lunch -= deductionPerMeal;
                config.dinner -= deductionPerMeal;
            }

            const html = types.map(t => {
                const recipe = dayData.plan[t.k];
                const skipped = dayData.skipped[t.k];
                const swapped = dayData.swapped[t.k];
                const displayCals = Math.max(0, config[t.k]);
                
                // WEEKEND FASTING CARDIO LOGIC
                if (isWeekend && t.k === 'breakfast' && skipped) {
                     return `
                    <div class="meal-card p-4 relative overflow-hidden meal-skipped bg-orange-50/50">
                        <div class="flex justify-between items-center">
                            <div class="flex items-center space-x-2 text-orange-600">
                                <span class="text-xl">${ICONS.run}</span>
                                <span class="text-sm font-bold">üî• Á©∫ËÖπÂø´Ëµ∞ 40mins (ËÑÇËÇ™ÁáÉÁáí)</span>
                            </div>
                            <button onclick="window.toggleSkip('${t.k}')" class="text-xs text-gray-400 font-medium">ÂèñÊ∂àÊúâÊ∞ß</button>
                        </div>
                    </div>`;
                }

                const ingredients = generateIngredients(recipe.name, isLight);
                const tip = generateTip(recipe.name, isLight);
                const subtext = generateSubtext(recipe.name, isLight, t.k);

                return `
                    <div class="meal-card p-5 relative overflow-hidden ${skipped ? 'meal-skipped' : ''} ${swapped ? 'animate-fade-in' : ''}">
                        <div class="flex justify-between items-center mb-3">
                            <div class="flex items-center space-x-2">
                                <span class="text-xl">${t.icon}</span>
                                <span class="text-base font-bold text-gray-900">${t.l}</span>
                                ${swapped ? '<span class="text-[9px] bg-blue-50 text-blue-600 px-1.5 py-0.5 rounded font-bold ml-1">‚ú® Â∑≤Êõ¥Êñ∞</span>' : ''}
                            </div>
                            <span class="bg-white border border-gray-100 text-gray-400 text-[10px] font-mono px-2 py-1 rounded">
                                ${displayCals} kcal
                            </span>
                        </div>
                        <div class="mb-4">
                            <div class="flex justify-between items-start">
                                <h3 class="text-base font-bold text-gray-800 leading-tight w-full">${recipe.name}</h3>
                                <div class="flex space-x-1 ml-2 flex-shrink-0">
                                    <button onclick="window.swapMeal('${t.k}')" class="w-6 h-6 rounded-full bg-gray-50 text-gray-400 hover:text-blue-600 flex items-center justify-center">
                                        ${ICONS.refresh}
                                    </button>
                                    <button onclick="window.toggleSkip('${t.k}')" class="w-6 h-6 rounded-full bg-gray-50 text-gray-400 hover:text-red-500 flex items-center justify-center">
                                        ${skipped ? ICONS.restore : ICONS.close}
                                    </button>
                                </div>
                            </div>
                            ${!skipped ? `<p class="text-xs text-gray-500 mt-1">${subtext}</p>` : ''}
                        </div>
                        ${!skipped ? `
                        <div class="space-y-1.5 mb-4 bg-gray-50/50 p-3 rounded-xl border border-gray-50">
                            ${ingredients.map(ing => `
                                <div class="flex items-start space-x-2">
                                    <div class="mt-1">${ICONS.check}</div>
                                    <span class="text-xs text-gray-600">${ing}</span>
                                </div>
                            `).join('')}
                        </div>
                        <div class="tip-box p-2.5 flex items-start space-x-2">
                            <div class="mt-0.5 flex-shrink-0">${ICONS.bulb}</div>
                            <p class="text-[11px] text-yellow-800/80 leading-relaxed font-medium">
                                ${tip}
                            </p>
                        </div>
                        ` : '<p class="text-xs text-red-400 text-center py-2">Êú¨È§êÂ∑≤Áï•ÈÅé</p>'}
                    </div>
                `;
            }).join('');
            document.getElementById('meals-container').innerHTML = html;
        }

        function renderFullMenu() {
            const list = document.getElementById('full-menu-list');
            const categories = {};
            RECIPES.forEach(r => {
                if (!categories[r.category]) categories[r.category] = [];
                categories[r.category].push(r);
            });

            const order = ['Êó©È§ê (Breakfast)', 'ÈõûËÇâÊñôÁêÜ (Chicken)', 'Á¥ÖËÇâÊñôÁêÜ (Beef/Pork)', 'Êµ∑ÈÆÆÊñôÁêÜ (Seafood)', 'Á¥†È£ü/ËºïÈ£ü (Veggie/Light)'];
            let html = '';
            order.forEach(cat => {
                if(categories[cat]) {
                    html += `
                        <div class="mb-6">
                            <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3 pl-1 border-b border-gray-100 pb-1">${cat}</h3>
                            <div class="space-y-2">
                                ${categories[cat].map(r => `
                                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg border border-gray-100">
                                        <span class="text-xs font-medium text-gray-800">${r.name}</span>
                                        ${r.tags.includes('light') ? '<span class="text-[9px] bg-emerald-100 text-emerald-600 px-1.5 py-0.5 rounded font-bold">L</span>' : ''}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
            });
            list.innerHTML = html;
        }

        // --- Init ---
        document.addEventListener('DOMContentLoaded', () => {
            generateWeeklyPlan();
            render();
        });
    </script>
</body>
</html>
